<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Ashwin Narayan on Ashwin Narayan</title>
    <link>https://www.ashwinnarayan.com/</link>
    <description>Recent content in Ashwin Narayan on Ashwin Narayan</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>&amp;copy; 2018 Ashwin Narayan</copyright>
    <lastBuildDate>Sun, 15 Oct 2017 00:00:00 +0800</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Learning Haskell Through Google Code Jam</title>
      <link>https://www.ashwinnarayan.com/post/learning-haskell-google-code-jam/</link>
      <pubDate>Sat, 13 Apr 2019 08:26:34 +0800</pubDate>
      
      <guid>https://www.ashwinnarayan.com/post/learning-haskell-google-code-jam/</guid>
      <description>

&lt;h2 id=&#34;introduction&#34;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;Over the last year or so, I&amp;rsquo;ve been playing around with &lt;a href=&#34;https://en.wikipedia.org/wiki/Functional_programming&#34; target=&#34;_blank&#34;&gt;functional programming&lt;/a&gt;. As the first few lines of the Wikipedia page suggest, functional programming is all about expressing a computation or algorithm as the composition of functions rather than using a state that changes over time. From what I&amp;rsquo;ve understood so far, functional programming is based on &lt;a href=&#34;https://en.wikipedia.org/wiki/Lambda_calculus&#34; target=&#34;_blank&#34;&gt;lambda calculus&lt;/a&gt; which is an alternative but equivalent formulation of the famous Turing Machine that most modern computers are based on.&lt;/p&gt;

&lt;p&gt;Of course, once you start reading up on functional programming, the language that is recommended the most is &lt;a href=&#34;https://www.haskell.org/&#34; target=&#34;_blank&#34;&gt;Haskell&lt;/a&gt;. I got interested in functional programming and Haskell in the first place because I was attracted by its more mathematical appearance and a lot of the code that I looked at seemed to express ideas much more clearly and (in my opinion) more beautifully. Learning Haskell was not easy at all. As someone who&amp;rsquo;s programmed using imperative programming languages all my life, I found it extremely difficult to think about solving problems using the style that Haskell (and functional programming) imposed. Near the beginning of my journey to learn it, there were quite a lot of stops and restarts and there were many instances where I questioned that it was even useful to learn the language as I found it so difficult to express ideas that were in my head simple to express in a language like Python. I also found writing programs that required I/O quite difficult. However, the aforementioned clarity and beauty that I found in the way functional programming expressed ideas stuck with me and I kept coming back to it. After nearly a year, things fell into place and I started being able to write code that was actually useful (i.e. interacted with the world through I/O). I feel like I&amp;rsquo;m finally at a point where I can program well enough in the language that I&amp;rsquo;m able to practice solving problems without struggling too much with I/O. So, when I got the email notifying me about this year&amp;rsquo;s Google Code Jam I thought I&amp;rsquo;d participate and try to use Haskell as much as possible!&lt;/p&gt;

&lt;h2 id=&#34;google-code-jam&#34;&gt;Google Code Jam&lt;/h2&gt;

&lt;p&gt;I&amp;rsquo;ve known about Google Code Jam for quite a while. I&amp;rsquo;ve even tried participating once before. The last time I participated, I was a very optimistic, but novice programmer and I did not even make it past the qualifying round. This was close to the beginning of my undergraduate degree. Since that time I&amp;rsquo;ve been programming on a regular basis for about six years. So, this time I did make it past the qualifying round quite comfortably. The main challenge I faced this time was that I was using a programming language that I didn&amp;rsquo;t quite know fully yet. But the added challenge did make solving the problems a lot more fun. Of the 4 problems in the qualifying round I solved 3. While solving these problems I was able to take advantage of quite a few functional programming patterns and I thought that it might be a good idea to write an article to show how Haskell&amp;rsquo;s higher order functions can be really useful in expressing common programming patterns in a concise and simple way.&lt;/p&gt;

&lt;h2 id=&#34;problem-1-foregone-solution&#34;&gt;Problem 1 - Foregone Solution&lt;/h2&gt;

&lt;p&gt;To read the full problem description &lt;a href=&#34;https://codingcompetitions.withgoogle.com/codejam/round/0000000000051705/0000000000088231&#34; target=&#34;_blank&#34;&gt;go here&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&#34;summary-of-problem-statement&#34;&gt;Summary of Problem Statement&lt;/h3&gt;

&lt;p&gt;The input for each testcase is a number N which when expressed in base 10 may or may not contain the digit 4. The goal is to split up the number N into 2 numbers A and B so that A + B = N and neither A nor B contain the digit 4.&lt;/p&gt;

&lt;h3 id=&#34;analysis&#34;&gt;Analysis&lt;/h3&gt;

&lt;p&gt;A brute force approach to the solution would search through all possible sums of two integers between 0 and N/2. Of course, this solution would scale as $O(N^2)$ and would not work with the larger test cases. Another thing to think about is that the hidden test cases can contain numbers between 1 and $10^{100}$. That number is beyond the range of usual integer data types. The problem can be solved quite easily by making the simple observation that you can split up all the digits that are 4 into 2 and 2 (or 3 and 1) and easily generate two numbers without even adding the two numbers to check if they sum up to N. For instance, if N is 9454 you can split it up into 9252 and 202. To do this you do not even need to convert the number into an integer data type. You can work with the string representation directly.&lt;/p&gt;

&lt;h3 id=&#34;solution&#34;&gt;Solution&lt;/h3&gt;

&lt;p&gt;I will read each test case number as a string and create two new numbers A and B. A will have all the digits 4 replaced with 2 and the remaining digits the same. B Will have all the digits 4 replaced with 2 and all the remaining digits replaced with 0. This pattern of replacing each member of an array with another one using information from only a single array element can be implemented using the higher order function &lt;code&gt;map&lt;/code&gt;. So, I defined two functions to calculate A and B.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-hs&#34;&gt;getA :: [Char] -&amp;gt; [Char]
getA n = map (\x -&amp;gt; if x == &#39;4&#39; then &#39;2&#39; else &#39;0&#39;) n

getB :: [Char] -&amp;gt; [Char]
getB n = map (\x -&amp;gt; if x == &#39;4&#39; then &#39;2&#39; else x) n
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;problem-2-you-can-go-your-own-way&#34;&gt;Problem 2: You Can Go Your Own Way&lt;/h2&gt;

&lt;p&gt;To read the full problem description &lt;a href=&#34;https://codingcompetitions.withgoogle.com/codejam/round/0000000000051705/00000000000881da&#34; target=&#34;_blank&#34;&gt;go here&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&#34;summary-of-the-problem-statement&#34;&gt;Summary of the Problem Statement&lt;/h3&gt;

&lt;p&gt;The goal is to get from the top right corner of an NxN grid to the bottom right corner using only South (Down) and East (Right) moves with the additional constraint that any segment of the path taken must not coincide (but can intersect at a single point) with another path that someone called Lydia took. The input is this path which is represented as a string containing uppercase &amp;ldquo;S&amp;rdquo; and &amp;ldquo;E&amp;rdquo; characters only.&lt;/p&gt;

&lt;h3 id=&#34;analysis-1&#34;&gt;Analysis&lt;/h3&gt;

&lt;p&gt;This problem looks more difficult to solve than it actually is. Once you know the trick, the code is quite simple. Before trying to solve the problem, I tried to write down some observations about the problem which helped a little.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Observation 1: Number of &lt;code&gt;S&lt;/code&gt; moves and &lt;code&gt;E&lt;/code&gt; moves must be exactly equal to &lt;code&gt;N-1&lt;/code&gt; if you want to reach the bottom right corner. You can see this by thinking of each move as a vector. This implies that it might be possible to find the solution by just transforming the input string as it is read.&lt;/li&gt;
&lt;li&gt;Observation 2: If I have a function that only stays the same or decreases along the X-axis and intersects the point (0, 0), I can mirror the function along the line y=-x and the only places where the path intersects will be crossings. That means I can solve this by just doing the opposite of whatever Lydia does at each step.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This means that I can take Lydia&amp;rsquo;s path and reverse the action she took at each step like some dark mirror and I have my solution. Interestingly, this problem can also be solved using the &amp;ldquo;map&amp;rdquo; higher order function pattern in Haskell. The meat of my solution was implemented in two functions. One is the character (move) mapping function:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-hs&#34;&gt;flipMove :: Char -&amp;gt; Char
flipMove c
    | c == &#39;S&#39; = &#39;E&#39;
    | c == &#39;E&#39; = &#39;S&#39;
    | otherwise = c
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And another is the function that transforms the input string into the output string.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-hs&#34;&gt;solveCase :: String -&amp;gt; String
solveCase lydiasMoves = map flipMove lydiasMoves
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;As before, the rest of the code is just IO. My full solution is &lt;a href=&#34;https://gist.github.com/RationalAsh/ba917a855dc63400245478ad4a03b1e5&#34; target=&#34;_blank&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&#34;problem-3-cryptopangrams&#34;&gt;Problem 3: Cryptopangrams&lt;/h2&gt;

&lt;p&gt;This problem was a bit harder than the others. I spent a lot of time thinking about this one and solved it quite close to the end of the round. Some of my initial attempts failed because I didn&amp;rsquo;t consider all the edge cases. Read the full problem statement &lt;a href=&#34;https://codingcompetitions.withgoogle.com/codejam/round/0000000000051705/000000000008830b&#34; target=&#34;_blank&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&#34;summary-of-problem-statement-1&#34;&gt;Summary of Problem Statement&lt;/h3&gt;

&lt;p&gt;A string is &amp;ldquo;encoded&amp;rdquo; using the following procedure:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;26 prime numbers less than a number N are chosen.&lt;/li&gt;
&lt;li&gt;The numbers are sorted in increasing order and a character map is made from the numbers to the corresponding letter between A and Z.&lt;/li&gt;
&lt;li&gt;Each character in the sentence is replaced with the corresponding prime number (spaces are removed and ignored).&lt;/li&gt;
&lt;li&gt;The prime number at each position is replaced with the product of the number and the number corresponding to the next character in the sentence.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;As an additional condition, the string is guaranteed to have all 26 characters occur at least once.&lt;/p&gt;

&lt;p&gt;For each case, as input, the maximum number N and the encoded sentence is given. The output should be the decoded sentence (without spaces).&lt;/p&gt;

&lt;h3 id=&#34;analysis-2&#34;&gt;Analysis&lt;/h3&gt;

&lt;p&gt;Let each sentence that is encoded be made of L characters. The set of primes that represent each of these characters can be represented by the sequence of numbers: $\{P_1, P_2, &amp;hellip; , P_L\}$. After the &amp;ldquo;encoding&amp;rdquo; procedure is carried out, the sequence will look like: $\{P_1\times P_2, P_2\times P_3, &amp;hellip; , P_{L-1}\times P_{L}\}$. The brute-force approach to solve this problem would involve trying to find the prime factors of each number in the sequence. However, if you look at the sequence above you can see that each number in the sequence except for the first one shares a common factor with the number before it! This means that if I find the common factors of the first two numbers in the sequence then I can factorize the entire sequence quite easily using the following procedure:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Find the common factor between the first two numbers in the sequence.&lt;/li&gt;
&lt;li&gt;Divide the first number by this common factor to get the first factor.&lt;/li&gt;
&lt;li&gt;Second factor is the common factor.&lt;/li&gt;
&lt;li&gt;For all subsequent numbers, the first factor is the common factor with the previous number and the second factor is the number divided by the common factor.&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;solution-1&#34;&gt;Solution&lt;/h3&gt;

&lt;p&gt;So first, I wrote a function to find the greatest common divisor between two numbers. This function implements &lt;a href=&#34;https://en.wikipedia.org/wiki/Euclidean_algorithm&#34; target=&#34;_blank&#34;&gt;Euclid&amp;rsquo;s Algorithm&lt;/a&gt; for find the greatest common divisor of two numbers:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-hs&#34;&gt;commonFactor :: Integer -&amp;gt; Integer -&amp;gt; Integer
commonFactor a b
    | remainder == 1 = 1
    | remainder == 0 = if a &amp;gt; b then b else a
    | otherwise = if a &amp;gt; b then commonFactor b remainder else commonFactor a remainder 
    where remainder = if a &amp;gt; b then snd (quotRem a b) else snd (quotRem b a)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In an imperative programming language we would loop through each character in the sequence to find the factors after setting up the loop by finding the common factor between the first two numbers. In Haskell the loop pattern for solving this particular problem is captured quite beautifully using the higher order function &lt;code&gt;scanl&lt;/code&gt;. The type signature for &lt;code&gt;scanl&lt;/code&gt; is &lt;code&gt;(b -&amp;gt; a -&amp;gt; b) -&amp;gt; b -&amp;gt; [a] -&amp;gt; [b]&lt;/code&gt;. This means that scanl takes a function that takes a type &lt;code&gt;a&lt;/code&gt; and &lt;code&gt;b&lt;/code&gt; and returns a &lt;code&gt;b&lt;/code&gt;, a member of type &lt;code&gt;b&lt;/code&gt; and a list of type &lt;code&gt;a&lt;/code&gt; and returns a list of type &lt;code&gt;b&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;A &lt;code&gt;scanl&lt;/code&gt; is a higher order function that is a variant of a general pattern in computing called a &lt;code&gt;fold&lt;/code&gt;. To put it very simply, a fold takes a starting value (sometimes called a &lt;em&gt;seed&lt;/em&gt;), a function and a list and applies the function repeatedly in a specific way. If I write down the fold imperatively in a language like Python, it would look like this (f is the function that is applied recursively):&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;seed = 0
for idx, elem in enumerate(lst):
    if idx == 0:
        result = f(seed, elem)
    else:
        result = f(result, elem)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;A &lt;code&gt;fold&lt;/code&gt; will run this loop and return the final value of the &lt;code&gt;result&lt;/code&gt; in the computation. A &lt;code&gt;scan&lt;/code&gt; is just a fold that returns a list of the intermediate values at each iteration in the loop. Haskell has two &lt;code&gt;scan&lt;/code&gt; functions that work on lists: &lt;code&gt;scanl&lt;/code&gt; and &lt;code&gt;scanr&lt;/code&gt;. &lt;code&gt;scanl&lt;/code&gt; starts the iteration from the left side of the list and &lt;code&gt;scanr&lt;/code&gt; starts the iteration from the right side of the list.&lt;/p&gt;

&lt;p&gt;With this in mind, I wrote a scanl based function to factorize the list of input numbers.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-hs&#34;&gt;factorizeCiphertext :: [Integer] -&amp;gt; [Integer]
factorizeCiphertext lst@(x1:x2:nums) = scanl (\n1 n2 -&amp;gt; n2 `div` n1) firstFactor lst
    where firstFactor = x1 `div` (commonFactor x1 x2)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In my first attempt at solving the problem, I thought that this was the full solution. But I kept getting runtime errors once I uploaded the answer to the website. After thinking about the problem for a little bit I realized that I&amp;rsquo;d missed out on some edge cases. There are two ways in which this solution can fail.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;If there are consecutive numbers that are identical at the &lt;em&gt;start&lt;/em&gt; of the sequence. The common factor algorithm will return the number itself. Consecutive identical numbers can be caused by either repeated characters (&amp;ldquo;AAAAAA&amp;rdquo;) or by repeated alternating characters (&amp;ldquo;ABABABA&amp;rdquo;) in the plain text.&lt;/li&gt;
&lt;li&gt;If there are multiple but different consecutive numbers at the start of the sequence. For instance, if the cipher text starts like &lt;code&gt;[9, 9, 9, 15, 15, 15, 35, 217]&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Note that if repeated characters appear in the middle of the sequence, it does not matter since the procedure we use will divide this number by the previous factor anyway. To handle this edge case, we&amp;rsquo;ll need to extract any successive repeated numbers from the start of the sequence. So I wrote two functions to split the input list into two lists. One contains any repeated characters at the start of the list and the other is the rest of the list.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-hs&#34;&gt;groupHead :: [Integer] -&amp;gt; [Integer]
groupHead (x:xs)
    | x == (head xs) = [x] ++ (takeWhile (==x) xs) ++ groupHead (dropWhile (==x) xs)
    | otherwise = []

groupTail :: [Integer] -&amp;gt; [Integer]
groupTail (x:xs)
    | x == (head xs) = groupTail (dropWhile (==x) xs)
    | otherwise = [x] ++ xs
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;For the rest of the list that does not have any initial repeating characters, the original &lt;code&gt;factorizeCiphertext&lt;/code&gt; function can be used to factorize the list. But how do we factorize the first part of the list? After a bit of thought I realized that if we factorize the first number in the second part of the list, it must have a common factor with the last number in the first part of the list. So now I can use this as the first factor to &lt;code&gt;scan&lt;/code&gt; the list from the right!&lt;/p&gt;

&lt;p&gt;So the final function that accounts for the edge cases is:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-hs&#34;&gt;factorizeCiphertext4 :: [Integer] -&amp;gt; [Integer]
factorizeCiphertext4 (n:nums)
    | isEdge = (scanr (\n1 n2 -&amp;gt; n1 `div` n2) (head factorTail) groupHeads) ++ (tail factorTail)
    | otherwise = factorTail
    where groupHeads = groupHead ([n] ++ nums)
          isEdge = if (length groupHeads) &amp;gt; 0 then True else False
          listToScan = groupTail ([n] ++ nums)
          firstFactor = (head listToScan) `div` (commonFactor (head listToScan) (head $ tail listToScan))
          factorTail = scanl (\f n -&amp;gt; n `div` f) firstFactor listToScan
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Haskell is a difficult language to learn, especially if you&amp;rsquo;ve only been exposed to imperative languages all your life. Rather than thinking in terms of discrete steps, you have to force yourself to think in terms of recursion and higher order patterns in the problem. However, if you stick with it for that initial amount of time that it takes to develop some basic proficiency, the results can be very rewarding. You can write some beautiful code in this language. After learning Haskell, I&amp;rsquo;ve also found myself using a functional approach to solve programming problems in other languages too! For instance, I&amp;rsquo;ve started using Python&amp;rsquo;s &lt;a href=&#34;https://docs.python.org/3/library/itertools.html&#34; target=&#34;_blank&#34;&gt;iterools&lt;/a&gt; package much more often.&lt;/p&gt;

&lt;p&gt;However, usefulness wasn&amp;rsquo;t the main factor that motivated me to learn Haskell. For me it was more about the fun of solving puzzles in clever and aesthetically pleasing ways. Haskell is one of the few languages that puts some fun back into solving programming problems. I think it brings in some of the beauty and rigor traditionally associated with pure mathematics into a programming language. If you&amp;rsquo;re someone who enjoys programming puzzles for their own sake and finds beauty in clever solutions to puzzles, I highly recommend giving Haskell a go.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The Witcher 3: Wild Hunt - A Review</title>
      <link>https://www.ashwinnarayan.com/post/witcher-3-review/</link>
      <pubDate>Sun, 16 Sep 2018 01:10:46 +0800</pubDate>
      
      <guid>https://www.ashwinnarayan.com/post/witcher-3-review/</guid>
      <description>&lt;p&gt;The Witcher 3 follows the story of Geralt of Rivia, a Witcher or monster slayer in search of his adoptive daugter Cirllia. (well it&amp;rsquo;s not &lt;em&gt;his&lt;/em&gt; story but we see the story through his eyes!). Set in a medieval world - after an event called the conjunction of spheres - magic and monsters (werewolves, spectres, vampire and the like.) roam the world. Witchers are magically and genetically enhanced humans that were created intentionally by sorcerers to help fight off these monsters. Cirilla (or Ciri) is a woman with special magical abilities and is prophesied to play a part in the fate of Geralt&amp;rsquo;s (and others) world(s) which are facing doom from a world ending White Frost.&lt;/p&gt;

&lt;p&gt;I purchased the game almost a year ago in December 2017 after getting strong recommendations from my friends. I&amp;rsquo;ll admit that I was a little intimidated at first. It was the third game in the series and it appeared as though I had a lot of catching up to do. I needn&amp;rsquo;t have worried too much though. One of the main features of the game are the huge number of random books lying around the world. You pick them up and they often contain bits and pieces of the story of the Witcher universe. However, one thing that was definitely intimidating was the combat mechanics. There were swords (two of them!), spells (signs), potions, decoctions, oils, bombs and crossbows all bound to correspondingly wide array of keys. Although the combat mechanics tutorial at the start of the game explained most things, it&amp;rsquo;s a lot to remember. I took a short break from playing the game for a few months in between and when I came back, I&amp;rsquo;d forgotten all the keybindings and had to play through the initial combat mechanics tutorial again to get used to things. Funnily enough although I preferred playing video games with a keyboard and mouse for the increased maneuverability, I think using a controller might be slightly easier for the Witcher 3 since you don&amp;rsquo;t have to keep track of random alphabets on the keyboard.&lt;/p&gt;

&lt;p&gt;The high level of immersion is what I enjoyed the most about the game. As a person that likes a bit of realism in games, I like it when the game mechanics do not break immersion. This is something I felt while playing &lt;a href=&#34;http://freebirdgames.com/to_the_moon/&#34; target=&#34;_blank&#34;&gt;To the Moon&lt;/a&gt; (brilliant game!). A lot of the progress in the game was made through solving what felt like very artificial puzzles (tile flipping jigsaws?). So it felt like alternating between experiencing the story and playing minigames. The Witcher has a ton of game mechanics but they&amp;rsquo;re all integrated into the story in a very natural way. Progress in the game is made through talking, interacting with objects and fighting. The fighting is quite realistic too. If I&amp;rsquo;m fighting a group of people they all come at me at once and I have dodge and roll between them to make sure that I don&amp;rsquo;t get hit from behind while fighting one person. Additionally, there&amp;rsquo;s no Pokemon like battle animation that signals the start of a battle. One second you&amp;rsquo;re walking along, minding your own stuff and the next second a drowner&amp;rsquo;s taking a swipe at you.&lt;/p&gt;

&lt;p&gt;The incredibly open world nature of the game is the second factor that adds to the realism and immersiveness. You can go almost anywhere on the absolutely huge map. There are practically no invisible walls that you can run into and obstacles that cannot be jumped over are at a realistic height most of the time. If you step off a cliff, you fall and if the fall is too great, you lose health and possibly die. The only invisible walls I&amp;rsquo;ve ever encountered are when you wander off to the edge of the map.&lt;/p&gt;

&lt;p&gt;The third factor that adds to the immersiveness of the game is the map itself. The world of Witcher 3 is &lt;em&gt;incredibly&lt;/em&gt; detailed. The cities like Oxenfurt and Novigrad feel like real full scale big cities. Although they are scaled down versions of the cities mentioned in the books, they&amp;rsquo;re still the biggest I&amp;rsquo;ve encountered in a video game. It was not like Pokemon where a &amp;ldquo;city&amp;rdquo; can be 4 buildings of which one is a Pokemon Center and another a Pokemart. I loved roaming around Novigrad (despite the nutjobs that are trying to burn witches alive). My favorite part of the city is probably the market square. I like how I can hear the chaotic sounds of a marketplace start up as you walk towards it. Outside the cities there are forests, snowy mountains, small villages, beaches and swamps all beatifully built and rendered in a very non-repetitive and organic way. The scenery never felt boring. It felt like nearly everything was placed and adjusted by hand. I was amazed in particular by the fantastical environments I encountered while traveling through the many parallel universes. The use of parallel universes in the game itself was quite a novel idea! I never thought that a game set in the medieval era would involve parallel universes and time travel. I saw worlds that were just deserts, worlds covered in frost, worlds with toxic gases and colorful plants. Even the modern day world (ours!) and possibly the world of Cyberpunk 2077 (another upcoming game by them) was mentioned in passing.&lt;/p&gt;

&lt;p&gt;Despite logging over 100 hours in the game over the past year, I have yet to finish all the quests in the game. I&amp;rsquo;ve completed the main story of the game but I&amp;rsquo;ve still got dozens of Witcher contracts and a few secondary quests left to finish off. On top of all that I have yet to start on the Hearts of Stone and Blood and Wine expansions of the game - which I hear are basically like two new games; adding 10 and 20 hours of playtime respectively. Looking at the scale of the game, I was quite surprised to learn that the game only took 3.5 years and 81 million USD to make (I was expecting a lot more!). The Witcher 3 is an RPG. So as expected the choices you make during quests play a part in the outcome of the game. Some decisions are clearly good/bad but in some quests &lt;a href=&#34;https://www.youtube.com/watch?v=MvgWlvfFJAk&#34; target=&#34;_blank&#34;&gt;all the choices are bad but you still have to choose&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;My only big criticism of the game is related to the combat difficulty near the start of the game. I&amp;rsquo;m not a gamer that plays games in hard mode. I play video games mainly to experience the story. So I tend to choose the lowest difficulty setting the game has. But even at the lowest difficulty, I had some trouble staying alive during some of the quests at the start of the game. I also had trouble with getting enough gold to buy things as I was spending most of my money keeping my equipment repaired (weapons and armor degrade as you use them). The problem was not too bad though and vanished as soon as I got out of White Orchard; character leveling happened much faster and I started getting gold quite a bit faster.&lt;/p&gt;

&lt;p&gt;I really enjoy playing story rich games like the Witcher 3. I feel like that is a very natural next step in the very human tradition of storytelling. We had spoken stories, then written, then acted out (movies). Interactive stories where the person experiences the story through his own actions is a very natural next step. In this regard, The Witcher stands out as the best game I&amp;rsquo;ve ever played. It manages to immerse me in the universe of Witcher 3 and feel like I&amp;rsquo;m really there. Every time I played the game, for a brief period of time I really was Geralt of Rivia. I felt what he felt, I did what he did. And in the end I felt like it had just as much (if not more) emotional impact as watching the story unfold in a movie or a book with the added advantage of being able to drive the story on my own rather than passively watch a film.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Hugo Web Development Workflow on Windows</title>
      <link>https://www.ashwinnarayan.com/post/hugo-windows-workflow/</link>
      <pubDate>Sun, 31 Dec 2017 11:41:31 +0530</pubDate>
      
      <guid>https://www.ashwinnarayan.com/post/hugo-windows-workflow/</guid>
      <description>

&lt;p&gt;As I mentioned in &lt;a href=&#34;https://www.ashwinnarayan.com/post/welcome/&#34; target=&#34;_blank&#34;&gt;my first article on this blog&lt;/a&gt;, I&amp;rsquo;m now using &lt;a href=&#34;https://gohugo.io/&#34; target=&#34;_blank&#34;&gt;Hugo&lt;/a&gt;, the static site generator to build my personal website. Due to the needs of my work environment (mostly because I need to use MS Word and certain MATLAB features on a regular basis), I&amp;rsquo;ve been primarily using Windows as my operating system for the past year or so. Having used Linux for a long time, I definitely missed the conveniences offered by shell scripting and other command line tools. However, while setting up a workflow in Windows for publishing content to my website I discovered that Windows&amp;rsquo; scripting tools are not all that bad. In fact, for anyone familiar with scripting from Linux, moving to Powershell isn&amp;rsquo;t that hard.&lt;/p&gt;

&lt;h2 id=&#34;workflow&#34;&gt;Workflow&lt;/h2&gt;

&lt;p&gt;A typical Hugo website development folder looks like this:
&lt;img src=&#34;https://www.ashwinnarayan.com/img/hugo_folders.jpg&#34; alt=&#34;Folder Structure&#34; /&gt;&lt;/p&gt;

&lt;p&gt;I add new posts by creating new markown (.md) files in the &lt;code&gt;post&lt;/code&gt; folder. When the website is compiled using the &lt;code&gt;hugo&lt;/code&gt; command, the static website&amp;rsquo;s code is generated into the &lt;code&gt;public&lt;/code&gt; folder. The content inside this is what goes into the folder that is served by any webserver. Since I am hosting the website on Github Pages, I found it most convenient to set up a separate folder with a clone of the &lt;code&gt;username.githug.io&lt;/code&gt; repository. After article writing/editing is done, I can generate the website and copy the contents inside the &lt;code&gt;public&lt;/code&gt; folder to the repository folder to publish.&lt;/p&gt;

&lt;p&gt;When I am editing an article, I can preview content locally by using the &lt;code&gt;hugo server --watch&lt;/code&gt; command in the top level directory. This sets up a local webserver on &lt;code&gt;localhost:1313&lt;/code&gt; so that you can preview the website.&lt;/p&gt;

&lt;p&gt;To publish my website to Github pages after I&amp;rsquo;m done with development, I copy everything inside the &lt;code&gt;public&lt;/code&gt; folder into my local copy of the github repository and then commit all and push.&lt;/p&gt;

&lt;h2 id=&#34;batch-script-automation&#34;&gt;Batch Script Automation&lt;/h2&gt;

&lt;p&gt;Most of the the steps in the workflow can be automated away using batch scripts to save large amounts of time. I mean, who wants to spend time manually copying files and commiting after every small edit to the website? The &lt;code&gt;build_on_laptop.bat&lt;/code&gt; file in the top level directory handles everything. Diving into the source, I first delete everything inside the &lt;code&gt;public&lt;/code&gt; folder (Hugo does not automatically do this) and build a fresh version of the website.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-dos&#34;&gt;rmdir /S /Q public
hugo
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;My Github pages repo has a few files that are not generated by Hugo. So I can&amp;rsquo;t just nuke the folder and delete everything. So I have a set of commands that delete all the Hugo generated files in the repository folder:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-dos&#34;&gt;rmdir /S /Q &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\categories&amp;quot;
rmdir /S /Q &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\css&amp;quot;
rmdir /S /Q &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\fonts&amp;quot;
rmdir /S /Q &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\home&amp;quot;
rmdir /S /Q &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\img&amp;quot;
rmdir /S /Q &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\js&amp;quot;
rmdir /S /Q &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\post&amp;quot;
rmdir /S /Q &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\project&amp;quot;
rmdir /S /Q &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\publication&amp;quot;
rmdir /S /Q &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\publication_types&amp;quot;
rmdir /S /Q &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\tags&amp;quot;
rmdir /S /Q &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\talk&amp;quot;
del &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\404.html&amp;quot;
del &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\index.html&amp;quot;
del &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\index.xml&amp;quot;
del &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\sitemap.xml&amp;quot;
del &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\site.webmanifest&amp;quot;
del &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io\styles.css&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then comes the task of copying your updated website source into the folder. While it&amp;rsquo;s possible to use the &lt;code&gt;cp&lt;/code&gt; command, I found that the &lt;code&gt;robocopy&lt;/code&gt; &lt;a href=&#34;https://technet.microsoft.com/en-us/library/cc733145.aspx?f=255&amp;amp;MSPPError=-2147217396&#34; target=&#34;_blank&#34;&gt;command&lt;/a&gt; is in general much better for copying files around in Windows.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-dos&#34;&gt;robocopy public &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io&amp;quot; /E
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Finally, I need to commit the new version of the website and push to github. This is also easily done:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-dos&#34;&gt;cd &amp;quot;C:\Users\Ashwin Narayan\rationalash.github.io&amp;quot;
set /p commitmsg=&amp;quot;Enter a commit message: &amp;quot;
git add --all .
git commit -m &amp;quot;%commitmsg%&amp;quot;
git push origin master
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So the end result is that when I run this script, it automatically deletes everything in the public folder and the repository folder, rebuilds and copies the new website over and then commits and pushes the new version to github to deploy the website.&lt;/p&gt;

&lt;h2 id=&#34;even-more-automation-with-visual-studio-code&#34;&gt;Even More Automation with Visual Studio Code&lt;/h2&gt;

&lt;p&gt;I can shave even more time off the workflow by using Visual Studio Code. VS Code has a really well made task management system. It&amp;rsquo;s also a natural choice since I do most of my markdown editing inside VS Code anyway. VS Code has a &lt;code&gt;tasks.json&lt;/code&gt; file where you can bind custom tasks/commands to key combinations. In this case, I just bound the default build task mapped to &lt;code&gt;Ctrl&lt;/code&gt;+&lt;code&gt;Alt&lt;/code&gt;+&lt;code&gt;B&lt;/code&gt; to the batch script. I also created a compose task which creates the local preview webserver.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
    // See https://go.microsoft.com/fwlink/?LinkId=733558
    // for the documentation about the tasks.json format
    &amp;quot;version&amp;quot;: &amp;quot;0.1.0&amp;quot;,
    &amp;quot;tasks&amp;quot;: [
        {
            &amp;quot;taskName&amp;quot;: &amp;quot;build&amp;quot;,
            &amp;quot;command&amp;quot;: &amp;quot;build_on_laptop.bat&amp;quot;,
            &amp;quot;isShellCommand&amp;quot;: true,
            &amp;quot;showOutput&amp;quot;: &amp;quot;always&amp;quot;,
            &amp;quot;echoCommand&amp;quot;: true
        },
        {
            &amp;quot;taskName&amp;quot;: &amp;quot;compose&amp;quot;,
            &amp;quot;command&amp;quot;: &amp;quot;hugo&amp;quot;,
            &amp;quot;args&amp;quot;: [&amp;quot;server&amp;quot;, &amp;quot;--watch&amp;quot;],
            &amp;quot;isShellCommand&amp;quot;: true,
            &amp;quot;showOutput&amp;quot;: &amp;quot;always&amp;quot;,
            &amp;quot;echoCommand&amp;quot;: true
        }
    ]    
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;With most of the steps automated, writing and publishing new articles don&amp;rsquo;t take that long compared to off the shelf solutions like Wordpress or Medium. It also comes with the advantage that you have full control over the website&amp;rsquo;s source code.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>My Review of Star Trek: Discovery</title>
      <link>https://www.ashwinnarayan.com/post/star-trek-discovery/</link>
      <pubDate>Sun, 10 Dec 2017 23:26:48 +0800</pubDate>
      
      <guid>https://www.ashwinnarayan.com/post/star-trek-discovery/</guid>
      <description>

&lt;div class=&#34;alert alert-warning&#34;&gt;
  &lt;p&gt;This article contains spoilers for all the episodes of Star Trek: Discovery.&lt;/p&gt;

&lt;/div&gt;


&lt;p&gt;As a lover of good science fiction I was really happy to hear the announcement of Star Trek: Discovery. I have not watched all of old Star Trek. But from the few that I have watched (Mostly Star Trek: Then Next Generation), I have come to love the Trek universe and the way it handles science fiction. I feel that of late, science fiction is leaning too much towards dystopian themes. I like the occasional story about a world in nuclear winter but I like optimistic or neutral science fiction far more. It appeals to the part of me that gets excited about science and my penchant for the cool technologies and knowledge that it generates. So stories like &lt;a href=&#34;https://en.wikipedia.org/wiki/Contact_(novel)&#34; target=&#34;_blank&#34;&gt;Contact&lt;/a&gt; and &lt;a href=&#34;https://en.wikipedia.org/wiki/Rendezvous_with_Rama&#34; target=&#34;_blank&#34;&gt;Rendezvous with Rama&lt;/a&gt; is much more up my alley. I consider even movies like &lt;a href=&#34;https://en.wikipedia.org/wiki/Interstellar_(film)&#34; target=&#34;_blank&#34;&gt;Interstellar&lt;/a&gt; as optimistic science fiction since even though the premise is that the earth is becoming uninhabitable, the story is that we work together to build the technology to colonize the stars. I consider &lt;a href=&#34;https://en.wikipedia.org/wiki/Her_(film)&#34; target=&#34;_blank&#34;&gt;Her&lt;/a&gt; science fiction although the focus of the movie was the relationship between Theodore and Samantha. The movie portrayed beautiful cityscapes and a future which looked distinctly &lt;a href=&#34;https://en.wikipedia.org/wiki/Post-scarcity_economy&#34; target=&#34;_blank&#34;&gt;post-scarcity&lt;/a&gt; as the characters seemed to not have to worry about basic needs and could live comfortably while doing basically whatever they wanted. In the case of Star Trek (at least for Star Trek: TnG) the episodes that I&amp;rsquo;ve watched so far fall under &lt;em&gt;very&lt;/em&gt; optimistic science fiction.&lt;/p&gt;

&lt;p&gt;One of my biggest fears about Star Trek: Discovery was that it would devolve into an action flick - especially because of the way the trailer was cut. It seemed to focus more on the action and less on the discovery/science/exploration part while also making the whole thing look like yet another dystopian sci-fi series. I felt that first two episodes seemed to run with this theme so much that they turned me away from the series initially and I took a break from it for nearly a month. But I came back to it one weekend when I was bored - and I&amp;rsquo;m glad I did. The episodes got better and so did the themes in them. While there was still an appreciable amount of action, they did not ignore the exploration and discovery part of things and. I also like that they specifically included characters whose biggest motivation was scientific curiosity. Here are some parts of the show that I particularly enjoyed:&lt;/p&gt;

&lt;h2 id=&#34;1-the-warp-capable-tardigrade&#34;&gt;1. The Warp Capable Tardigrade&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;https://www.ashwinnarayan.com/img/tardigrade-teleports.gif&#34; alt=&#34;Warp Capable Tardigrade&#34; /&gt;
Basing the strange creature on the real world &lt;a href=&#34;https://en.wikipedia.org/wiki/Tardigrade&#34; target=&#34;_blank&#34;&gt;tardigrade&lt;/a&gt; was a really cool idea. Apart from the fact that the creature looked really cool, I like that they treated it with kindness (at least in the case of Burnham) and let it go at the end.&lt;/p&gt;

&lt;h2 id=&#34;2-the-mycelial-network-and-the-spore-drive&#34;&gt;2. The Mycelial Network and The Spore Drive&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;https://www.ashwinnarayan.com/img/black-alert2.gif&#34; alt=&#34;Spore Drive&#34; /&gt;
I was nerding out when the show started talking about a giant fungus spanning the entire universe because it&amp;rsquo;s actually based on an amazing real world fungus called the &lt;a href=&#34;https://en.wikipedia.org/wiki/Armillaria_ostoyae&#34; target=&#34;_blank&#34;&gt;&lt;em&gt;Armillaria ostoyae&lt;/em&gt;&lt;/a&gt;  which is often reported as one of the largest living organisms in the world. There&amp;rsquo;s a single fungal colony of this type in the Malheur National Forest in the Blue Mountains of eastern Oregon, U.S, spanning 8.9 square kilometers. It&amp;rsquo;s estimated to be 2400 years old. The spore drive animations are amazing and it&amp;rsquo;s a creative plot device too.&lt;/p&gt;

&lt;h2 id=&#34;3-the-imperfect-captain&#34;&gt;3. The Imperfect Captain&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;https://www.ashwinnarayan.com/img/gabriel_lorca.jpg&#34; alt=&#34;Gabriel Lorca&#34; /&gt;
In the older Star Treks, I felt that the captains tended to be very &amp;ldquo;perfect&amp;rdquo; characters (Kirk, Picard). They tended to be the kind of characters that are &lt;em&gt;obviously&lt;/em&gt; good. However, the captain of the U.S.S Discovery is quite a bit less than perfect. In fact, he does quite a lot of things that are decidedly in the gray zone. In fact, the way he was introduced in the series is very similar to how villians are sometimes introduced in films. This gave me an initial sense of apprehension about the character - I got a fleeting sense that this dude is a bit evil and might not up to any good. In fact, I spent most of the episodes expecting something sinister to happen and for Lorca to pull an Admiral Marcus (Into Darkness) and reveal that he is in fact on the dark side of the force. But &lt;em&gt;that&lt;/em&gt; never happened. Now I feel like he is a good captain who just has some unusual interest in war and does the odd unethical thing to get what he wants. Whatever the case, he added a lot of interest and depth to the new Star Trek and I like that he was not the same type of Captain as Kirk or Picard. In fact, I thought that Gabriel Lorca was a more interesting character than Michael Burnham (who I feel the showrunners are trying to make &lt;em&gt;the&lt;/em&gt; main character.).&lt;/p&gt;

&lt;h2 id=&#34;summing-up&#34;&gt;Summing Up&lt;/h2&gt;

&lt;p&gt;I feel that Star Trek: Discovery was well executed. While it is not exactly the same as the original Star Treks, I feel that the parts that were changed added more to the story than it took away. I like the mid season &amp;ldquo;finale&amp;rdquo; in which the crew of the Discovery were stranded in what seemed to be an alternate dimension. It is reminiscent of the TNG episode &lt;a href=&#34;http://memory-alpha.wikia.com/wiki/Where_No_One_Has_Gone_Before_(episode)&#34; target=&#34;_blank&#34;&gt;&amp;ldquo;Where No One Has Gone Before&amp;rdquo;&lt;/a&gt; in which the crew does some crazy new warp technique to go to the edge of the known universe. I look forward to seeing release of rest of the season next year. I&amp;rsquo;m curious to find out how they will handle the parallel universes thing.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>How to Integrate Quaternions</title>
      <link>https://www.ashwinnarayan.com/post/how-to-integrate-quaternions/</link>
      <pubDate>Sun, 10 Sep 2017 17:58:08 +0800</pubDate>
      
      <guid>https://www.ashwinnarayan.com/post/how-to-integrate-quaternions/</guid>
      <description>

&lt;p&gt;I&amp;rsquo;ve been spending a lot of time working with inertial measurement units recently and am discovering the surprising amount of mathematics that goes into using data from accelerometers and gyroscopes to get the orientation of an object in 3D space. The story begins with me trying to integrate an angular velocity vector (in 3D) to get the orientation of an object. Angular velocity is a vector but common representations of orientation (like Euler Angles) are not. So getting the orientation is &lt;em&gt;not&lt;/em&gt; as simple as doing $\int_0^t \vec{\omega} \mathscr{d}t$.&lt;/p&gt;

&lt;p&gt;Rotations in two dimensions are really easy because there is only one plane in which you can do the rotation. The only thing you can change is the center of rotation. The orientation of an object in 2 dimensions can be given by a single angle $\phi$ measured relative to the origin of the coordinate system. The angular velocity of an object in 2 dimensions can also be represented by a single number $\omega$ which is defined as the rate of change of the angle $\phi$. This gives us the basic formula we learn in high school physics.
$$\omega = \frac{d\phi}{dt} = \frac{v_{\bot}}{r}$$
&lt;img src=&#34;https://www.ashwinnarayan.com/img/angular_velocity.svg&#34; alt=&#34;angular_velocity_image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Rotations in 3D are much more complicated. In 3 dimensions, the plane of rotation can be any among an infinite number of possibilities. The origin or &amp;ldquo;center&amp;rdquo; of rotation now becomes an &lt;em&gt;axis&lt;/em&gt; of rotation which is represented by a vector. The plane of rotation is perpendicular to the axis of rotation. This is a result of the &lt;a href=&#34;https://en.wikipedia.org/wiki/Euler%27s_rotation_theorem&#34; target=&#34;_blank&#34;&gt;Euler Rotation Theorem&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Before I can start integrating angular velocity I need to choose a representation for the orientation. There are several different conventions when it comes to representing the orientation of an object in 3D. The most popular approach is to use a set of three angles called &lt;a href=&#34;https://en.wikipedia.org/wiki/Euler_angles&#34; target=&#34;_blank&#34;&gt;Euler Angles&lt;/a&gt;. This approach was developed by the mathematician Leonhard Euler (pronounced oy-ler not you-ler). These set of three angles specify three successive rotations around three different axes in a very specific order. The order is important because rotations in 3D have an important property: they do not &lt;em&gt;commute&lt;/em&gt;. This means that if I do rotation 1 before 2 I end up with a different orientation than if I do 2 before 1. Euler angles usually specify rotations in the ZXZ order. This means that the first axis of rotation is the current Z-axis. The second axis of rotation is the new X-axis &lt;em&gt;after&lt;/em&gt; the first rotation. The final axis of rotation is the new Z-axis after the first and second rotations. A closely related approach is to use what&amp;rsquo;s called &lt;a href=&#34;https://en.wikipedia.org/wiki/Euler_angles#Tait-Bryan_angles&#34; target=&#34;_blank&#34;&gt;Tait-Bryan angles&lt;/a&gt;. Tait-Bryan angles are called yaw, pitch and roll and are commonly used when talking about the orientation of aircraft. The angles represent successive rotations around the body fixed X, Y and Z axes. Both Euler angles and Tait-Bryan angles however, suffer from something called &lt;a href=&#34;https://en.wikipedia.org/wiki/Gimbal_lock&#34; target=&#34;_blank&#34;&gt;Gimbal Lock&lt;/a&gt;. This is when for a certain value of one of the rotation angles, a degree of freedom is lost and two rotations &amp;ldquo;collapse&amp;rdquo; into a single rotation. The Wikipedia page linked has some nice visualizations and a short mathematical explanation (using rotation matrices) for why this happens.&lt;/p&gt;

&lt;p&gt;Using Quaternions to represent rotations is a way to avoid the Gimbal Lock problem. Quaternions are so useful for representing orientations that most Kalman Filters that need to track 3D orientations use them instead of Euler Angles. So I settled on using quaternions. When I first started working with quaternions I found them a little difficult to understand. So I thought of writing an article about the path I took to understand and use quaternions for &amp;ldquo;integrating&amp;rdquo; angular velocity.&lt;/p&gt;

&lt;p&gt;From all my time working with mathematics, I&amp;rsquo;ve come to realize that mathematical ideas exist on a spectrum. At one end is math that is focused on the practical application. Math that is very close to the real world (as experienced by humans) and can be understood easily by making analogies to things that humans encounter in everyday life. This is the type of math that is often applied to solve everyday problems like settling bills or building bridges. At the other end of the spectrum is the type of math that is pure abstraction. This type of abstract math is often used to generalize specific results in practical math to other problems or to come up with new insights that can pave the way for new solutions to a problem. Quaternions are a little more towards the abstract end of the spectrum and can be difficult to get an intuition for. Sometimes though there are ideas that you &lt;em&gt;can&amp;rsquo;t&lt;/em&gt; get an intuition for. Working with such math is mostly a matter of getting used to it. With abstract math, the best way I&amp;rsquo;ve found to get used to it is to learn the basic definition and keep applying it to problems until you get the hang of it. The understanding forms in the brain automatically as you get the hang of it.&lt;/p&gt;

&lt;h2 id=&#34;quaternion-math&#34;&gt;Quaternion Math&lt;/h2&gt;

&lt;p&gt;So without further ado, I&amp;rsquo;ll talk about what quaternions are and how they behave.&lt;/p&gt;

&lt;h3 id=&#34;representation&#34;&gt;Representation&lt;/h3&gt;

&lt;p&gt;A quaternion $q$ can be represented as a tuple of 4 numbers:
$$q = \begin{bmatrix} w &amp;amp; \ x &amp;amp;\ y &amp;amp; \ z \end{bmatrix} = \begin{bmatrix} w &amp;amp; \ \vec{v}\end{bmatrix} = w + x\mathrm{i} + y\mathrm{j} + z\mathrm{k} $$&lt;/p&gt;

&lt;p&gt;where the $w$ is the &lt;em&gt;scalar&lt;/em&gt; part and the $\vec{v}$ is the &lt;em&gt;vector&lt;/em&gt; part.&lt;/p&gt;

&lt;p&gt;Two binary operations are defined for quaternions: addition $+$ and quaternion multiplication $\otimes$.&lt;/p&gt;

&lt;h3 id=&#34;addition&#34;&gt;Addition&lt;/h3&gt;

&lt;p&gt;Addition is defined as the component-wise sum just like for a 4D vector. The sum is commutative (order is not important) and associative (grouping is not important).&lt;/p&gt;

&lt;p&gt;$$ q_1 + q_2 = \begin{bmatrix} w_1 + w_2 &amp;amp; \ x_1 + x_2 &amp;amp; \ y_1 + y_2 &amp;amp; \ z_1 + z_2 \end{bmatrix} = q_2 + q_1$$&lt;/p&gt;

&lt;h3 id=&#34;multiplication&#34;&gt;Multiplication&lt;/h3&gt;

&lt;p&gt;Quaternion multiplication is defined in multiple ways but the formula that I find the easiest to remember is:
$$ q_1 \otimes q_2 = \begin{bmatrix} w_1 w_2 - \vec{v}_1\cdot\vec{v}_2 &amp;amp; \ w_1\vec{v}_2 + w_2\vec{v}_1 + \vec{v}_1\times\vec{v}_2 \end{bmatrix} $$&lt;/p&gt;

&lt;p&gt;The multiplication is &lt;em&gt;non-commutative&lt;/em&gt; ($q_1 \otimes q_2 \neq q_2 \otimes q_1$ ) and distributive over the sum $(q_1 \otimes (q_2 + q_3) = q_1 \otimes q_2 + q_1 \otimes q_3 )$.&lt;/p&gt;

&lt;h3 id=&#34;norm-conjugate-and-inverse&#34;&gt;Norm, Conjugate and Inverse&lt;/h3&gt;

&lt;p&gt;It&amp;rsquo;s also useful to define the norm of a quaternion as:
$$ ||q|| = \sqrt{w^2 + x^2 + y^2 + z^2} $$&lt;/p&gt;

&lt;p&gt;a conjugate quaternion $ q^* $ that satisfies the property $ q \otimes q^* = ||q||^2 $ as
$$ q^* = \begin{bmatrix} w &amp;amp; \ -x &amp;amp; \ -y &amp;amp; \ -z \end{bmatrix} $$&lt;/p&gt;

&lt;p&gt;and a quaternion inverse $q^{-1}$ with the property $q \otimes q^{-1} = \begin{bmatrix} 1 \ 0 \ 0 \ 0 \end{bmatrix}$ as
$$ q^{-1} = \frac{q^*}{||q||^2} $$&lt;/p&gt;

&lt;h2 id=&#34;using-quaternions-for-rotation&#34;&gt;Using Quaternions for Rotation&lt;/h2&gt;

&lt;p&gt;Now that the behaviour of quaternions are established, there is the question of how to use them to represent 3D rotation. From Euler&amp;rsquo;s Rotation Theorem it is clear that rotations have 3 degrees of freedom. But quaternions as 4 tuples have 4 degrees of freedom. So an additional constraint needs to be imposed to use them to represent rotations. This is done by requiring that the quaternions are &lt;em&gt;unit&lt;/em&gt; quaternions: $||q|| = 1$. Unit quaternions are also called &lt;em&gt;versors&lt;/em&gt;. There are many diagrams and visualizations that attempt to make understanding the unit quaternion more intuitive but I found that for me, most were misleading. I found it the most useful to think of quaternions as just an abstract object with the properties that I&amp;rsquo;ve mentioned and &lt;em&gt;not&lt;/em&gt; trying to have any picture in mind. The moment I left behind the crutch of visualization and forced myself to accept and think about quaternions as they are, everything fell into place.&lt;/p&gt;

&lt;p&gt;To rotate a 3D vector $\vec{r}$ by a versor $q$ an operation called &lt;em&gt;conjugation&lt;/em&gt; is used.
$$ \vec{r}&amp;rsquo; = q \otimes \begin{bmatrix} 0 &amp;amp; \ \vec{r} \end{bmatrix} \otimes q^{*} $$&lt;/p&gt;

&lt;p&gt;If I find the formula quite mysterious (as I did when I first saw it), it&amp;rsquo;s helpful to use one of the other methods (euler angles, axis angle) to rotate a vector and verify that the result is the same.&lt;/p&gt;

&lt;p&gt;It&amp;rsquo;s possible to compose two rotations represented by two quaternions $q_1$ and $q_2$ by multiplying the two quaternions together $q_2 \otimes q_1$. This product represents the rotation $q_1$ applied before $q_2$.&lt;/p&gt;

&lt;h3 id=&#34;quaternions-rotation-matrices-and-the-rotation-group-so-3&#34;&gt;Quaternions, Rotation Matrices and the Rotation Group $SO(3)$&lt;/h3&gt;

&lt;p&gt;Earlier, I mentioned that rotations in 3D have certain properties (like non-commutativity) that implies that they don&amp;rsquo;t belong to a vector space (and therefore can&amp;rsquo;t be represented by one). If I want to be exact when talking about rotations, I have to consider them as a &lt;em&gt;group&lt;/em&gt;. A group is yet another mathematical abstraction. Abstractly, think of them as a set of objects that follow certain rules. Remember that groups are another concept that leans towards the abstract end of the mathematical spectrum. They &lt;em&gt;can&lt;/em&gt; be applied to rotations but they were invented by mathematicians to study more general ideas. So what rules does a group follow?&lt;/p&gt;

&lt;p&gt;A group is a set $G$ along with some &lt;em&gt;binary&lt;/em&gt; operation $\cdot$ (takes two elements of the set and gives a third). The elements of the set follow these rules:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Closure: If $a,b \in G$ then $a\cdot b \in G$.&lt;/li&gt;
&lt;li&gt;Associativity: If $a,b,c \in G$ then $a\cdot ( b \cdot c) = (a \cdot b) \cdot c $.&lt;/li&gt;
&lt;li&gt;Identity: There&amp;rsquo;s some element of the set $e$ which has the property $a \cdot e = e\cdot a = a$.&lt;/li&gt;
&lt;li&gt;Inverse: If $a \in G$ there&amp;rsquo;s some element $a^* $ such that $a \cdot a^* = a^* \cdot a = e$.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;If you compare this to 3D rotations, you can see that the set of 3D rotations are an example of a group under the binary operation of composition (doing one rotation after another)!&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Closure: If I compose two rotations it forms another rotation. It doesn&amp;rsquo;t suddenly become a translation or scaling or shear. There&amp;rsquo;s no way to combine rotations to do any of these other operations.&lt;/li&gt;
&lt;li&gt;Associativity: If I do three rotations, it doesn&amp;rsquo;t matter which two I compose first.&lt;/li&gt;
&lt;li&gt;Identity: There&amp;rsquo;s an identity rotation ($0^\circ$ of rotation around any axis).&lt;/li&gt;
&lt;li&gt;And there&amp;rsquo;s an inverse rotation (rotating by negative of the angle around the same axis.)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Quaternions under multiplications &lt;em&gt;also&lt;/em&gt; satisfy all these properties.&lt;/p&gt;

&lt;p&gt;If I convert Euler angle rotations to rotation matrices and compare them with quaternions, the parallels between them are very clear.&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Group Property&lt;/th&gt;
&lt;th&gt;Rotation Matrix $R_i \in G$&lt;/th&gt;
&lt;th&gt;Quaternion $q_i \in \mathbb{H}_R$&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Closure&lt;/td&gt;
&lt;td&gt;$R_1 \cdot R_2 \in G$&lt;/td&gt;
&lt;td&gt;$q_1 \otimes q_2 \in \mathbb{H}_R$&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Associativity&lt;/td&gt;
&lt;td&gt;$R_1 \cdot (R_2 \cdot R_3) = (R_1 \cdot R_2) \cdot R_3$&lt;/td&gt;
&lt;td&gt;$q_1 \otimes (q_2 \otimes q_3) = (q_1 \otimes q_2) \otimes q_3$&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Identity&lt;/td&gt;
&lt;td&gt;$I$&lt;/td&gt;
&lt;td&gt;$1$&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;Inverse&lt;/td&gt;
&lt;td&gt;$R_i^{-1} = R_i^{T} $&lt;/td&gt;
&lt;td&gt;$q_i^{-1}$&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;The closure and associativity properties rotation matrices can be easily seen as a consequence of the fact that rotation matrices are &lt;a href=&#34;https://en.wikipedia.org/wiki/Orthogonal_matrix&#34; target=&#34;_blank&#34;&gt;orthogonal matrices&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;With this knowledge of the rules that rotations follow, it&amp;rsquo;s clear why it&amp;rsquo;s silly to think of the Euler angles as a vector. They&amp;rsquo;re a set of related numbers but vectors they are not! It&amp;rsquo;s also clear why integrating the angular velocity vector over time does not directly give the orientation in an easily usable form.&lt;/p&gt;

&lt;h3 id=&#34;representing-quaternion-rotation-as-a-matrix&#34;&gt;Representing quaternion rotation as a matrix&lt;/h3&gt;

&lt;p&gt;Linearity of operations are an important property that both engineers and mathematicians like to take advantage of. It can result in useful simplifications of results. So it&amp;rsquo;s useful (later in this article) to ask the question: Is quaternion multiplication a linear operation? The simplest way to find out is to write out the result of a general quaternion multiplication operation and check if it&amp;rsquo;s possible to represent it as a matrix multiplication.&lt;/p&gt;

&lt;p&gt;The symbolic result of multiplying two quaternions $q_1$ and $q_2$ is:
$$ q_1 \otimes q_2 = \left[\begin{matrix}w_1 w_2 - x_1 x_2 - y_1 y_2 - z_1 z_2\\ w_1 x_2 + w_2 x_1 + y_1 z_2 - y_2 z_1\\ w_1 y_2 + w_2 y_1 - x_1 z_2 + x_2 z_1\\ w_1 z_2 + w_2 z_1 + x_1 y_2 - x_2 y_1\end{matrix}\right] $$&lt;/p&gt;

&lt;p&gt;From inspection, this can be written as a matrix product:
$$ q_1 \otimes q_2 = \left[\begin{matrix}w_2 &amp;amp; -x_2 &amp;amp; -y_2 &amp;amp; -z_2\\ x_2 &amp;amp; w_2 &amp;amp; z_2 &amp;amp; - y_2\\ y_2 &amp;amp; - z_2 &amp;amp; w_2 &amp;amp; x_2\\ z_2 &amp;amp; y_2 &amp;amp; - x_2 &amp;amp; w_2\end{matrix}\right] \begin{bmatrix} w_1 \\ x_1 \\ y_1 \\ z_1 \end{bmatrix} $$&lt;/p&gt;

&lt;p&gt;And if I change the order of multiplication:
$$ q_2 \otimes q_1 = \left[\begin{matrix}w_2 &amp;amp; - x_2 &amp;amp; - y_2 &amp;amp; - z_2 \\ x_2 &amp;amp; w_2 &amp;amp; - z_2 &amp;amp; y_2 \\ y_2 &amp;amp; z_2 &amp;amp; w_2 &amp;amp; - x_2 \\ z_2 &amp;amp; - y_2 &amp;amp; x_2 &amp;amp; w_2\end{matrix}\right] \begin{bmatrix} w_1 \\ x_1 \\ y_1 \\ z_1 \end{bmatrix} $$&lt;/p&gt;

&lt;h2 id=&#34;integrating-angular-velocity&#34;&gt;Integrating Angular Velocity&lt;/h2&gt;

&lt;p&gt;To properly integrate angular velocity to get a quaternion, I need to find a relationship between quaternions and angular velocity - or more precisely - a differential equation that relates the time derivative of the quaternion $\dot{q}$ and the angular velocity vector $\vec{\omega}$.&lt;/p&gt;

&lt;p&gt;A natural place to start is the original definition of the angular velocity from physical law. If I imagine a vector of constant $\vec{s}(t)$ length stretching out from the origin undergoing rotation with the instantaneous angular velocity $\vec{\omega}(t)$ I can find the velocity at the tip of this vector by taking it&amp;rsquo;s derivative.
$$ \frac{\mathrm{d}\vec{s}}{\mathrm{d}t} = \vec{\omega} \times \vec{s} $$&lt;/p&gt;

&lt;p&gt;Since the angular velocity is perpendicular to the vector $\vec{s}$ (driving their dot product $\vec{\omega} \cdot \vec{s}$ to zero) the equation can also be written in quaternion form as:
$$ \frac{\mathrm{d}\vec{s}}{\mathrm{d}t} = \vec{\omega} \otimes \vec{s} $$&lt;/p&gt;

&lt;p&gt;Now I imagine that this instantaneous vector is represented by a quaternion $q$ rotation from a constant vector $\vec{s}_0$.
$$\begin{align} \vec{s} &amp;amp;= q \otimes \vec{s}_0 \otimes q^* \\
\frac{\mathrm{d}\vec{s}}{\mathrm{d}t} &amp;amp;= \frac{\mathrm{d}}{\mathrm{d}t} \left[ q \otimes \vec{s}_0 \otimes q^* \right]
\end{align}$$&lt;/p&gt;

&lt;p&gt;So how do I take that nasty looking derivative on the side? Well it turns out that the product rule of derivatives that is valid in basic calculus is also perfectly valid for quaternion multiplication! I converted the quaternion product into a matrix multiplication and spent some time converting the derivatives of the product to the result from applying the product rule. The only thing to watch out for is the non commutativity of the multiplication. The order of the quaternion product shouldn&amp;rsquo;t be changed when applying the product rule.&lt;/p&gt;

&lt;p&gt;$$ \frac{\mathrm{d}}{\mathrm{d}t} \left[ q \otimes \vec{s}_0 \otimes q^* \right] =  \dot{q} \otimes \vec{s}_0 \otimes q^* +  q \otimes \vec{s}_0 \otimes \dot{q^*} $$&lt;/p&gt;

&lt;p&gt;There&amp;rsquo;s a term in this equation - the derivative of the conjugate - that&amp;rsquo;ll cause some trouble. It is possible to eliminate this using other methods but the simplest way is to directly find a relationship between $\dot{q}$ and $\dot{q^*}$. The easy way to do this is to take the derivative of the product of a quaternion and it&amp;rsquo;s conjugate which we know to be 1:&lt;/p&gt;

&lt;p&gt;$$\begin{align}
\frac{\mathrm{d}}{\mathrm{d}t} (q \otimes q^* ) &amp;amp;=  \frac{\mathrm{d}}{\mathrm{d}t} 1 \\
\dot{q} \otimes q^* + q \otimes \dot{q^*} &amp;amp;= 0 \end{align} $$&lt;/p&gt;

&lt;p&gt;That gives the relationship&lt;/p&gt;

&lt;p&gt;$$ \dot{q^* } = -q^* \otimes \dot{q} \otimes q^* $$&lt;/p&gt;

&lt;p&gt;Expressing $s_0$ in terms of $s$, substituting $\dot{q^* } $ and doing a little algebra:
$$ \frac{\mathrm{d}}{\mathrm{d}t} \left[ q \otimes \vec{s}_0 \otimes q^* \right] =  \dot{q} \otimes q^* \otimes \vec{s} -  \vec{s} \otimes \dot{q} \otimes q^* = \vec{\omega} \otimes \vec{s} $$&lt;/p&gt;

&lt;h3 id=&#34;the-quaternion-commutator&#34;&gt;The Quaternion Commutator&lt;/h3&gt;

&lt;p&gt;The expression $ \dot{q} \otimes q^* \otimes \vec{s} -  \vec{s} \otimes \dot{q} \otimes q^* $ is in the form $p \otimes q - q \otimes p$ which is defined as a &lt;em&gt;commutator&lt;/em&gt; operation written as $[p, q]$. Going through the algebra of this operation and simplifying:&lt;/p&gt;

&lt;p&gt;$$ [q_1, q_2] = \begin{bmatrix} 0 \ 2(\vec{v}_1 \times \vec{v}_2) \end{bmatrix} $$&lt;/p&gt;

&lt;p&gt;Interestingly, if both $q_1$ and $q_2$ are &lt;em&gt;pure quaternions&lt;/em&gt; (They do not have a scalar part) then the quaternion commutator and the product are related:&lt;/p&gt;

&lt;p&gt;$$[\vec{q}_1, \vec{q}_2] = 2(q_1 \times q_2) = 2(q_1 \otimes q_2) $$&lt;/p&gt;

&lt;h3 id=&#34;the-product-dot-q-q-is-a-pure-quaternion&#34;&gt;The Product $\dot{q} q^* $ is a Pure Quaternion&lt;/h3&gt;

&lt;p&gt;$$\begin{align} \dot{q} \otimes q^* + q \otimes \dot{q^* } &amp;amp;= 0 \\
  \dot{q} \otimes q^* &amp;amp;= -(\dot{q} \otimes q^* )^*
 \end{align} $$&lt;/p&gt;

&lt;p&gt;Saying that a $q = -q^* $ is the same as saying that $w = -w$ which means that the scalar part of the quaternion is zero.&lt;/p&gt;

&lt;h3 id=&#34;the-differential-equation&#34;&gt;The Differential Equation&lt;/h3&gt;

&lt;p&gt;So finally, I can extract the quaternion differential equation:&lt;/p&gt;

&lt;p&gt;$$ \begin{align}  \dot{q} \otimes q^* \otimes \vec{s} -  \vec{s} \otimes \dot{q} \otimes q^* &amp;amp;= \vec{\omega} \otimes \vec{s} \\
\left[\dot{q} \otimes q^* , \vec{s}\right] &amp;amp;= \vec{\omega} \otimes \vec{s} \\
2\dot{q} \otimes q^* \otimes \vec{s} &amp;amp;= \vec{\omega} \otimes \vec{s} \\
\dot{q} &amp;amp;= \frac{1}{2} \vec{\omega} \otimes q \end{align} $$&lt;/p&gt;

&lt;p&gt;In this equation the $\vec{\omega}$ is the angular velocity in the global fixed frame. In many situations it&amp;rsquo;s more useful to have an equation in terms of the angular velocity as measured by a reference frame fixed to the moving body - like when it is measured using a gyroscope. The angular velocity in this frame is the global angular velocity rotated into the body frame $\vec{\omega}&amp;rsquo; = q^* \otimes\vec{\omega}\otimes q $. Replacing $\vec{\omega}$ gives the more useful differential equation:&lt;/p&gt;

&lt;p&gt;$$ \dot{q} = \frac{1}{2} q \otimes  \vec{\omega} $$&lt;/p&gt;

&lt;h3 id=&#34;integration&#34;&gt;Integration&lt;/h3&gt;

&lt;p&gt;To solve this differential equation is to be able to integrate it. Normal differential equations are difficult enough. How does one solve a differential equation with a &lt;em&gt;quaternion multiplication&lt;/em&gt; in it? This is where the linearity of the quaternion multiplication becomes very useful. I am also going to make a (reasonable) assumption - that the angular velocity is constant over a time $\Delta t$. Then I can rewrite the differential equation in a well known form:&lt;/p&gt;

&lt;p&gt;$$ \begin{bmatrix} \dot{w} \\ \dot{x} \\ \dot{y} \\ \dot{z} \end{bmatrix} = \left[\begin{matrix}0 &amp;amp; - \omega_x &amp;amp; - \omega_y &amp;amp; - \omega_z \\ \omega_x &amp;amp; 0 &amp;amp; \omega_z &amp;amp; - \omega_y \\ \omega_y &amp;amp; - \omega_z &amp;amp; 0 &amp;amp; \omega_x \\ \omega_z &amp;amp; \omega_y &amp;amp; - \omega_x &amp;amp; 0 \end{matrix}\right] \cdot \begin{bmatrix} w \\ x \\ y \\ z \end{bmatrix} $$&lt;/p&gt;

&lt;p&gt;This is an ODE in the form $\dot{q} = Aq$ where A is the big matrix. The solution to this differential equation then is:&lt;/p&gt;

&lt;p&gt;$$ q(t) = e^{A(t - t_0 )} q_0 $$&lt;/p&gt;

&lt;h3 id=&#34;quaternion-exponential&#34;&gt;Quaternion Exponential&lt;/h3&gt;

&lt;p&gt;Interestingly, if I define the quaternion exponential in the same way as the matrix exponential (using its Taylor Series representation), I get a quaternion equivalent formula.&lt;/p&gt;

&lt;p&gt;$$ \begin{align} \exp{(q)} &amp;amp;= e^{w}e^{\vec{v}} \\
   &amp;amp;= e^{w}\left(\sum_0^\infty \frac{\vec{v}^k}{k!}\right) \\
   &amp;amp;= e^{w}\left(\cos{|\vec{v}|} + \frac{\vec{v}}{|\vec{v}|} \sin{|\vec{v}|}\right) \end{align} $$&lt;/p&gt;

&lt;p&gt;Using the quaternion exponential, the solution to the differential equation can be expressed in quaternion form as:&lt;/p&gt;

&lt;p&gt;$$ q(t) = \exp{\left(\frac{1}{2}\vec{\omega}\Delta t\right)} \otimes q_0 $$&lt;/p&gt;

&lt;h2 id=&#34;summing-up&#34;&gt;Summing Up&lt;/h2&gt;

&lt;p&gt;I started out with the simple sounding task of integrating angular velocity and in trying to solve it, traversed through a several different areas of mathematics and learned a lot along the way before coming to the final solution. However, my description here is far from complete. The equation above only holds if the angular velocity is constant over a time period. This means its a &amp;ldquo;first order&amp;rdquo; model. Dropping this assumption gives $n^{th}$ order models for integration. There are also intricate details that I&amp;rsquo;m only beginning to understand. For instance, I&amp;rsquo;m reading about how rotations are a special type of group called &lt;a href=&#34;https://en.wikipedia.org/wiki/Lie_group&#34; target=&#34;_blank&#34;&gt;Lie Groups &lt;/a&gt; where the group is also a &lt;a href=&#34;https://en.wikipedia.org/wiki/Differentiable_manifold&#34; target=&#34;_blank&#34;&gt;differentiable manifold&lt;/a&gt; (yet another interesting abstract mathematical object). The space of angular velocity forms what is called a &lt;a href=&#34;https://en.wikipedia.org/wiki/Lie_algebra&#34; target=&#34;_blank&#34;&gt;Lie Algebra &lt;/a&gt; on the group. And the quaternion exponential function which most texts I refer to seem to pull out of thin air is actually related to a more general idea called an exponential map which maps general Lie Algebras to Lie Groups.&lt;/p&gt;

&lt;p&gt;Despite it&amp;rsquo;s incompleteness however, it is the minimum that I needed to understand to be able to actually implement in code the integration of a quaternion - i.e use quaternions practically for integrating data coming in from an inertial measurement unit. I hope that others trying to understand quaternions and their role in representing 3D rotations will find this article useful. Some of the references below go deeper into the nature of quaternions and how to use them for useful things like tracking orientations.&lt;/p&gt;

&lt;h2 id=&#34;references&#34;&gt;References&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/pdf/1604.08139.pdf&#34; target=&#34;_blank&#34;&gt;Boyle, Michael. &amp;ldquo;The integration of angular velocity.&amp;rdquo; Advances in Applied Clifford Algebras (2016): 1-30.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Rotation_group_SO(3)&#34; target=&#34;_blank&#34;&gt;https://en.wikipedia.org/wiki/Rotation_group_SO(3)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Quaternion&#34; target=&#34;_blank&#34;&gt;https://en.wikipedia.org/wiki/Quaternion&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://hal.archives-ouvertes.fr/hal-01122406/document&#34; target=&#34;_blank&#34;&gt;Sola, Joan. &amp;ldquo;Quaternion kinematics for the error-state KF.&amp;rdquo; (2015).&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://math.stackexchange.com/questions/1030737/exponential-function-of-quaternion-derivation&#34; target=&#34;_blank&#34;&gt;https://math.stackexchange.com/questions/1030737/exponential-function-of-quaternion-derivation&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>Bash Recipes for Doing Science!</title>
      <link>https://www.ashwinnarayan.com/post/bash-recipes-for-science/</link>
      <pubDate>Sun, 13 Aug 2017 19:30:14 +0800</pubDate>
      
      <guid>https://www.ashwinnarayan.com/post/bash-recipes-for-science/</guid>
      <description>

&lt;p&gt;When prototyping programs that deal with lots of data on an Arduino and other embedded systems or even on full blown computers, it&amp;rsquo;s really useful to have a quick tool for plotting the output of the program. Initially, I used python for doing this. Python is a beautifully simple language and between Numpy, Scipy and Matplotlib, you can do pretty much anything you want with data; from doing simple plotting to running machine learning algorithms on the data. However, when all you want is to quickly plot a text file containing some data, breaking out a text editor to write a python script can get annoying especially if you do it many times a day.&lt;/p&gt;

&lt;p&gt;That was when I came across this interesting video from the computerphile YouTube channel.&lt;/p&gt;


&lt;div style=&#34;position: relative; padding-bottom: 56.25%; padding-top: 30px; height: 0; overflow: hidden;&#34;&gt;
  &lt;iframe src=&#34;//www.youtube.com/embed/vT_J6xc-Az0&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%;&#34; allowfullscreen frameborder=&#34;0&#34; title=&#34;YouTube Video&#34;&gt;&lt;/iframe&gt;
 &lt;/div&gt;


&lt;p&gt;It&amp;rsquo;s a fantastic interview with Brian Kernighan where he talks about his work on Unix and in particular then &lt;code&gt;awk&lt;/code&gt; command line tool. I&amp;rsquo;ve been using linux as my primary operating system for quite some time now and I do a lot of programming in it. So I am fairly comfortable with using the terminal for compiling and debugging code. But there was never a situation where I had to sit down and learn about all the terminal based utilities that were available. As I was watching Brian Kernighan describe &lt;code&gt;awk&lt;/code&gt; and how it works, I started to realize that I could really use this tool to my advantage when playing around with data. That was when I decided take a closer look at all the tools that were available on the linux terminal to see what I was missing out on.&lt;/p&gt;

&lt;p&gt;Over time I&amp;rsquo;ve developed a few &amp;ldquo;recipes&amp;rdquo; that are really useful to me and I thought I&amp;rsquo;d share some that I&amp;rsquo;ve found particularly useful.&lt;/p&gt;

&lt;h2 id=&#34;1-log-and-monitor-a-serial-port&#34;&gt;1. Log and monitor a serial port&lt;/h2&gt;

&lt;p&gt;Logging and monitoring serial ports is a really common thing to have to do - especially if you&amp;rsquo;re working with embedded systems like the Arduino. It&amp;rsquo;s a standard way of getting data off the microcontroller. Checking what&amp;rsquo;s being logged to the serial port is as simple as running:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cat /dev/ttyUSB0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Sometimes the command exits immediately or shows garbled output (due to the wrong baud rate). You can use &lt;code&gt;stty&lt;/code&gt; to change the serial port settings.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;stty -F /dev/ttyUSB0 115200 min 1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I can also log the data from the serial port conveniently to a text file,&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cat /dev/ttyUSB0 &amp;gt; logfilename.txt
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;2-log-and-monitor-network-ports&#34;&gt;2. Log and monitor network ports&lt;/h2&gt;

&lt;p&gt;One of the ways to get data off an Arduino is using an XBee device to wirelessly transmit it. I&amp;rsquo;m a big fan of using the XBee WiFi module to log data to a UDP port on my laptop. To view incoming data from the UDP port, I use a really useful tool called &lt;code&gt;netcat&lt;/code&gt;. Say the device is logging data to port 9750. I can listen in on the data by running,&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;netcat -ul 9751
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;and log the data if I like.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;netcat -ul 9751 &amp;gt; log.txt
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;3-plot-data-in-a-log-file-from-the-terminal&#34;&gt;3. Plot data in a log file from the terminal&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;feedgnuplot&lt;/code&gt; is a really useful Perl script that can read data from &lt;code&gt;stdin&lt;/code&gt; and pass it to &lt;code&gt;gnuplot&lt;/code&gt; for plotting. The only requirement is that the data arrive in a specific format: One sample per line, spaces between each data stream. This means your data in the file should look like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;1.0 1.5 2.3
1.1 1.3 2.7
2.6 5.9 3.3
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;To plot the data:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cat log.txt | feedgnuplot --lines --autolegend
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;code&gt;--autolegend&lt;/code&gt; option automatically numbers each line in the graph. The &lt;code&gt;--legend&lt;/code&gt; option can be used to add custom legends. I highly recommend going through the &lt;a href=&#34;http://manpages.ubuntu.com/manpages/zesty/man1/feedgnuplot.1.html&#34; target=&#34;_blank&#34;&gt;feedgnuplot manpage&lt;/a&gt; to find out about all the functionality that the script offers.&lt;/p&gt;

&lt;h2 id=&#34;4-plot-only-specific-data&#34;&gt;4. Plot only specific data&lt;/h2&gt;

&lt;p&gt;The &lt;code&gt;awk&lt;/code&gt; command is useful for filtering data that comes into the program line by line. A simple way it can be applied is to plot only specific columns in the text data.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cat log.txt | awk &#39;{ print $1, $2 }&#39; | feedgnuplot --lines --autolegend
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;code&gt;awk&lt;/code&gt; command as shown here will filter out only columns 1 and 2 from the log file and pass it on to &lt;code&gt;feedgnuplot&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;awk&lt;/code&gt; can also be used to do more complicated things like select lines with only numbers or only text. This can be useful if the log file contains other debug output lines as well and you want to filter out and plot just the lines that contain numeric data. &lt;a href=&#34;https://en.wikipedia.org/wiki/AWK&#34; target=&#34;_blank&#34;&gt;Wikipedia&lt;/a&gt; has a pretty good introduction to &lt;code&gt;awk&lt;/code&gt;. I also found that a lot of the time, I could find what I needed for specific problems by searching stackoverflow.&lt;/p&gt;

&lt;h2 id=&#34;5-process-data-before-plotting&#34;&gt;5. Process data before plotting&lt;/h2&gt;

&lt;p&gt;What if I have some raw data in a log file that you want to run through some processing (more complicated than an &lt;code&gt;awk&lt;/code&gt; one liner)? I write a simple python script that reads lines from &lt;code&gt;stdin&lt;/code&gt; and writes the processed sample to &lt;code&gt;stdout&lt;/code&gt;. If I do this, I can plot the result by doing&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cat log.txt | ./process_script.py | feedgnuplot --lines --autolegend
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;or log it to another file.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cat log.txt | ./process_script.py &amp;gt; processed_data.txt
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;6-interpret-packed-binary-data&#34;&gt;6. Interpret packed binary data&lt;/h2&gt;

&lt;p&gt;If the data in the log file, or data that&amp;rsquo;s coming in from a serial port or network interface is in some packed binary format, there&amp;rsquo;s a handy tool called &lt;code&gt;od&lt;/code&gt; that can interpret it on the fly.
The command below will interpret data coming in as packets of 8 bytes as 2 byte integers.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;netcat -ul 9751 | od -An -td2 -w8
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;od&lt;/code&gt; is a versatile tool and as is usual for linux programs, I recommend reading the &lt;a href=&#34;http://manpages.ubuntu.com/manpages/trusty/man1/od.1.html&#34; target=&#34;_blank&#34;&gt;manpage&lt;/a&gt; to know more about what it can do.&lt;/p&gt;

&lt;h2 id=&#34;7-process-plot-live-data-streams&#34;&gt;7. Process/Plot live data streams&lt;/h2&gt;

&lt;p&gt;If I have data coming in from from a serial port or from a network interface and I want to create a real-time plot, &lt;code&gt;feedgnuplot&lt;/code&gt; has an option for that.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cat /dev/ttyUSB0 | feedgnuplot --lines --autolegend --xlen 100 --stream 0.1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;code&gt;--xlen&lt;/code&gt; option plots a window of the last 100 samples and the &lt;code&gt;--stream&lt;/code&gt; option updates the plot as new data comes in. The parameter 0.1 is the refresh rate.&lt;/p&gt;

&lt;p&gt;I can even run the live data stream through my processing algorithm before plotting.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;netcat -ul 9750 | ./process_data.py | feedgnuplot --lines --autolegend --xlen 100 --stream 0.1
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;8-redirecting-to-multiple-programs&#34;&gt;8. Redirecting to multiple programs.&lt;/h2&gt;

&lt;p&gt;Sometimes I&amp;rsquo;ve been in a situation where I want to monitor data coming in from a serial port &lt;em&gt;and&lt;/em&gt; log it to a file at the same time. One way of doing this is to write a python script that reads data from &lt;code&gt;stdin&lt;/code&gt;, logs it to a file and also writes the same data to &lt;code&gt;stdout&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cat /dev/ttyUSB0 | ./log_and_print.py | feedgnuplot --lines --xlen 100 --stream 0.1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This is good if you only want to do one extra thing with the output. There is a better solution however that uses the &lt;code&gt;tee&lt;/code&gt; command.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cat /dev/ttyUSB0 | tee &amp;gt;(command1) &amp;gt;(command2) &amp;gt;(logfile.txt) | feedgnuplot --lines --autolegend --xlen 100 --stream 0.1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This technique is quite versatile and can be used in many ways. For example, I can use tee to get the raw data from the serial port, plot it, pass it through a data processing script and plot the output of that result as well for a comparison.&lt;/p&gt;

&lt;h2 id=&#34;summing-up&#34;&gt;Summing up&lt;/h2&gt;

&lt;p&gt;I&amp;rsquo;m sure that there are many more clever ways to combine and compose these commands to make prototyping easier as well as commands that I don&amp;rsquo;t know about yet. If there is one thing that I&amp;rsquo;ve learned after using linux for a few years it&amp;rsquo;s that it often has modest looking command line tools that can do much more than a lot of GUI based applications if you spend just a little time to go through the manpage. I hope that this post inspires others to take a second look at the free tools that come with most linux distros. Some of them could really simplify your workflow!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Programming Complex Dataflows in C</title>
      <link>https://www.ashwinnarayan.com/post/dataflow-programming-in-c/</link>
      <pubDate>Tue, 01 Aug 2017 00:15:14 +0800</pubDate>
      
      <guid>https://www.ashwinnarayan.com/post/dataflow-programming-in-c/</guid>
      <description>

&lt;p&gt;Over the past few months I&amp;rsquo;ve been spending a lot of time on implementing various signal processing algorithms in C/C++. Things like Kalman Filters, various types of FIR filters and finite state machines. The number of steps needed to implement each these algorithms were fairly small and in the beginning I tried to put all the functionality of these implementations into simple to use C++ classes. This made things look neater and also fit in quite well with the Arduino programming framework (I was implementing a lot of these algorithms on Arduino compatible microcontrollers like the Teensy). However, once I started combining different algorithms together to make something bigger, the code started becoming very messy. Making changes and debugging was starting to take longer and longer. In many instances, I had to go back and change the deisgn and interface of my C++ classes when I realized that the way I initially implemented it made it impossible or very difficult to do some step in the algorithm. I decided to take some time to figure out how I can do better. I wanted to find out a systematic method - a &amp;ldquo;meta-programming&amp;rdquo; algorithm if you will - that would tell me the way I should implement the algorithm so that the code is easy to write and more importantly, easy to read and debug.&lt;/p&gt;

&lt;h2 id=&#34;representing-the-algorithm&#34;&gt;Representing the Algorithm&lt;/h2&gt;

&lt;p&gt;Before I could start solving the problem I needed to decide how to represent a general data processing algorithm. What is a representation that can capture most if not all of the types of algorithms that I wanted to implement? I remembered that in a lot of papers that I&amp;rsquo;ve read, the authors used Simulink to implement their algorithm. So I decided to start out by assuming that I can represent what I want to do in the form of a block diagram - much like the block diagrams that you can draw in Simulink. It turns out that as long as they don&amp;rsquo;t have any cycles or loops, block diagrams with arrows representing the flow of data between the blocks can be represented by a mathematical structure called a Directed Acyclic Graph.&lt;/p&gt;

&lt;h2 id=&#34;directed-acyclic-graphs&#34;&gt;Directed Acyclic Graphs&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Graph_theory&#34; target=&#34;_blank&#34;&gt;Graphs&lt;/a&gt; as a mathematical structure (different from the graphs that you use to plot data) are useful for representing relationships between things. Intuitively I think of them as circles connected by lines. The circles represent things and the lines represent some type of relationship between the things. If this seems very abstract, that&amp;rsquo;s because graphs can be applied to a &lt;em&gt;lot&lt;/em&gt; of different things and when an concept is that general, it tends to be very abstract. As an example, a graph can be used to represent an electrical circuit. Each discrete component like a resistor or an LED can be considered a node or vertex in the graph (circles). The wires that connect these components together can be considered the edges of the graph.&lt;/p&gt;


&lt;figure&gt;
    
        &lt;img src=&#34;https://imgs.xkcd.com/comics/collatz_conjecture.png&#34; alt=&#34;A graph representing the collatz sequence and some unrelated drawings.&#34; /&gt;
    
    
    &lt;figcaption&gt;
        &lt;p&gt;
        A graph representing the collatz sequence and some unrelated drawings.
        &lt;a href=&#34;https://xkcd.com/710/&#34;&gt; 
            Source: xkcd
        &lt;/a&gt; 
        &lt;/p&gt; 
    &lt;/figcaption&gt;
    
&lt;/figure&gt;


&lt;p&gt;A &lt;a href=&#34;https://en.wikipedia.org/wiki/Directed_graph&#34; target=&#34;_blank&#34;&gt;directed graph&lt;/a&gt; is a graph in which the edges connecting the nodes have a direction. The graph in the image from xkcd is a directed graph since it has arrows connecting the nodes of the graph.&lt;/p&gt;

&lt;p&gt;A &lt;a href=&#34;https://en.wikipedia.org/wiki/Directed_acyclic_graph&#34; target=&#34;_blank&#34;&gt;directed acyclic graph&lt;/a&gt; (DAG) is a directed graph that does not have &lt;em&gt;cycles&lt;/em&gt; in it. This means that there is no way to start at a node in the graph and follow the arrows from node to node and reach the node you started at. A directed acyclic graph is useful for modeling dependencies. If you&amp;rsquo;re planning to understand some big concept in science - General Relativitiy for example - there are prerequisite ideas that you need to understand first. A subject and it&amp;rsquo;s prerequisites can be arranged in the form of a directed acyclic graph.&lt;/p&gt;


&lt;figure&gt;
    
        &lt;img src=&#34;https://www.ashwinnarayan.com/img/markov_chains.png&#34; alt=&#34;A directed acyclic graph showing the dependencies for learning about Markov Chains.&#34; /&gt;
    
    
    &lt;figcaption&gt;
        &lt;p&gt;
        A directed acyclic graph showing the dependencies for learning about Markov Chains.
        &lt;a href=&#34;https://metacademy.org&#34;&gt; 
            Source: Metacademy
        &lt;/a&gt; 
        &lt;/p&gt; 
    &lt;/figcaption&gt;
    
&lt;/figure&gt;


&lt;h2 id=&#34;topological-sorting&#34;&gt;Topological Sorting&lt;/h2&gt;

&lt;p&gt;Given a DAG showing the dependencies for learning about Markov chains like in the image above, one might ask the question: Is there a way to list the nodes of the graph in correct learning order &lt;em&gt;i.e&lt;/em&gt; the order in which any dependencies for a node appear before the node itself is listed. It turns out that &lt;a href=&#34;https://en.wikipedia.org/wiki/Topological_sorting&#34; target=&#34;_blank&#34;&gt;you can&lt;/a&gt;! Every DAG has at least one way in which we can make this sorted list and there are a few algorithms for doing so.&lt;/p&gt;

&lt;p&gt;So if you want to learn something new, topologically sorting a dependency graph of the topic is a nice approach! In fact, this is exactly what the website &lt;a href=&#34;https://metacademy.org&#34; target=&#34;_blank&#34;&gt;Metacademy&lt;/a&gt; does! It gives you the order in which to learn things using topological sorting.&lt;/p&gt;

&lt;h2 id=&#34;dataflows&#34;&gt;Dataflows&lt;/h2&gt;

&lt;p&gt;So how does this relate to programming algorithms represented by block diagrams in C? I thought of the block diagram as a directed acyclic graph. The blocks which represent steps in the data processing algorithm are represented by nodes in the graph and the arrows that connect the blocks represent the flow of data. In programming, the nodes in the block diagram can be naturally represented by functions whose arguments are the incoming edges and the return values are the outgoing edges. This also means that the edges themselves can be naturally represented by variables in the C program. Once I&amp;rsquo;ve defined all the edge variables and block functions, I need to figure out what is the correct order in which to call each of these block functions. The &amp;ldquo;correct&amp;rdquo; order can be defined as the order in which each function is only called once all the variables that represent the input edges to the block have been updated (if necessary) in the current iteration of the main loop of the program. It turns out that this correct order is the same as the topologically sorted order of the function blocks.&lt;/p&gt;

&lt;p&gt;So to summarize the systematic meta algorithm to implement a data processing algorithm in C:&lt;/p&gt;

&lt;p&gt;Start out with a fresh &lt;code&gt;.h&lt;/code&gt; file which will contain your implementation&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Construct a block diagram of the algorithm showing the data flow.&lt;/li&gt;
&lt;li&gt;Make sure that the block diagram is a directed acyclic graph.&lt;/li&gt;
&lt;li&gt;Give names to each node and edge.&lt;/li&gt;
&lt;li&gt;For each edge in the graph, declare a C variable in the global scope. I use the &lt;code&gt;static&lt;/code&gt; keyword if I want to make sure that the variable is only visible inside the header file. The data type of the C variable depends on the node that the edge originates from.&lt;/li&gt;
&lt;li&gt;For each node in the graph, declare a function that takes as arguments pointers to both the input and and output edge variables from the node. It is useful to declare the input pointers as &lt;code&gt;const&lt;/code&gt; to ensure that the function does not modify the data in the edge variables. The function uses the input to carry out the processing step and modifies the output edge variables. I use &lt;code&gt;static&lt;/code&gt; variables inside the function if I need to keep track of any state (like for finite state machines).&lt;/li&gt;
&lt;li&gt;Any parameters needed by the processing step inside the function can either be declared globally or as a const argument of the function. Personally, I like to have the simple parameters as &lt;code&gt;#define&lt;/code&gt;s at the top of the header file so I can tweak/change them easily.&lt;/li&gt;
&lt;li&gt;If there are parameters that need to be modified/tuned during execution, they can be declared as variables global to the file. This is useful if you&amp;rsquo;re running a code that implements something like a PID controller and you want to tune the gains of the controller online. I use an &lt;a href=&#34;https://github.com/RationalAsh/CmdArduino&#34; target=&#34;_blank&#34;&gt;Arduino library&lt;/a&gt; that listens to incoming commands on one of the Serial ports.&lt;/li&gt;
&lt;li&gt;Define an initialization function that initializes all the edge variables to an initial state (if necessary).&lt;/li&gt;
&lt;li&gt;Define a main function graph execution function that calls the block functions in the topologically sorted order.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Here&amp;rsquo;s a rough outline of what the &lt;code&gt;.h&lt;/code&gt; file will look like.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;#ifndef DATA_PROC_H
#define DATA_PROC_H

//#defines and parameters
#define PARAM1 0

//Define the edge variables with the appropriate type
float e1, e2, e3, e4
int e5;
//Define the node function prototypes
void F1(const float in1, const float in2, float *out);
void F2(const float in1, const float in2, float *out);
void F3(const float in1, int *out);

//Define the initialization function
void data_proc_init()
{
    e1 = 0;
    e2 = 0;
    e3 = 0;
    e4 = 0;
}

//Define the main execution pipeline function
void data_proc_exec()
{
    //Node functions called in the topologically sorted order
    F1(e1, e2, &amp;amp;e3);
    F2(e2, e3, &amp;amp;e4);
    F3(e4, &amp;amp;e5);
}

//Function implementations
//Implement the node functions here

#endif
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And in the main C file:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;#include &amp;quot;data_proc.h&amp;quot;

int main(int argc, char** argv)
{
    //Run the initialization function
    data_proc_init();

    while(loop_condition)
    {
        //Execute pipeline function in loop
        data_proc_exec();
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I&amp;rsquo;ve noticed that if I stick to these rules consistently, my code is generally much easier to read. As long as I give descriptive names to the block functions, I only need to look at the main execution function to figure out the flow of the program. Debugging becomes easier too! It becomes a matter of adding one function from the topologically sorted list at a time and checking the output for correctess.&lt;/p&gt;

&lt;p&gt;While the meta algorithm that I wrote down is specifically for C, this method can easily be extended to other programming languages. Python would make doing this even easier as it is much more flexible with functions returning data. Instead of taking in pointers to the output variables as arguments, the function can actually return tuples of data that can be assigned to the output edge variables.&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;m sure that this method will have some limitations. One I can see right away is that it uses a lot of variables. One for each edge and even more for the static variables inside the function. On memory constrained systems like small microcontrollers, the RAM can run out pretty fast (Declaring non-tweakable parameters as being stored in the code ROM should help with this a bit). Another problem is the question of what to do with algorithms that can&amp;rsquo;t be represented as a DAG. I don&amp;rsquo;t know if it&amp;rsquo;s possible to represent all possible algorithms using DAGs (A quick google search did not turn up any conclusive answers). I am also unsure how this model can be used for programming things like GUIs which sit around and wait for events to happen most of the time. However, when implementing control and signal processing algorithms, I find this method is singularly better than the others I&amp;rsquo;ve tried.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ICRA 2017</title>
      <link>https://www.ashwinnarayan.com/post/icra-2017/</link>
      <pubDate>Mon, 05 Jun 2017 22:50:52 +0800</pubDate>
      
      <guid>https://www.ashwinnarayan.com/post/icra-2017/</guid>
      <description>

&lt;p&gt;The IEEE International Conference on Robotics and Automation (ICRA) that happened in Singapore over the last week is often referred to as &lt;em&gt;the&lt;/em&gt; robotics conference. If you&amp;rsquo;re an academic working in the field of robotics, Singapore was the place to be in the last week. So I spent most of my time hanging around the Marina Bay Sands Hotel Convention center as a student volunteer for the conference, helping out and - in my free time - attending some of the hundreds of presentations that that took place.&lt;/p&gt;

&lt;p&gt;One thing that completely blew me away was the scale of the event. It made me realize how vast human knowledge is and how my life&amp;rsquo;s entire work would just be a miniscule part of the sum total. Robotics itself is just a small portion of all there is to know. And even in a conference dedicated to this field, I had to sift through dozens to subfields to attend the talks that were relevant to my narrow area of research.&lt;/p&gt;

&lt;h2 id=&#34;day-1&#34;&gt;Day 1&lt;/h2&gt;

&lt;hr /&gt;

&lt;p&gt;The first day of the conference did not have any paper presentations. I guess they wanted to give the delegates from other countries time to get used to the place before they had to present their work. There were however, workshops on several different subjects that were going on. It was also one of the busiest days as a volunteer for me since I was helping out with the registrations of those coming in for the conference. I spent the day helping people get their conference ID tags (which were used for access control) and package. Instead of the usual thick booklet of the conference schedule, ICRA 2017 gave out to all the delegates an android tablet pre-loaded with an app that had the full conference schedule.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://www.ashwinnarayan.com/img/Registration-Desk.jpg&#34; alt=&#34;Registration Desk of ICRA 2017&#34; title=&#34;Caption&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Registration work ended at 4.30 and I had some time to catch the end of a very interesting workshop on rehabiliation robotics.&lt;/p&gt;

&lt;h2 id=&#34;days-2-4&#34;&gt;Days 2 - 4&lt;/h2&gt;

&lt;hr /&gt;

&lt;p&gt;Days 2 - 4 were when the bulk of the conference happened. The papers were classified into sub topics and the presentations for each sub topic happened in different rooms. I feel like the organizers did a good job of separating the papers out in a way that prevented situations where you had two relevant sessions that you had to be in at the same time. After listening to many people presenting their work, I feel a little less nervous about the time I&amp;rsquo;ll have to present my own work in a conference. For the most part, people were friendly, interested and loved to discuss with you about your work after the presentation. In fact, I&amp;rsquo;ll say that I&amp;rsquo;m almost looking forward to my next conference so that I can discuss with interested people about my work.&lt;/p&gt;

&lt;p&gt;Conferences are also very intellectually stimulating! As I listened to the presentations I also found myself getting new ideas for how I could solve problems that I&amp;rsquo;m facing in my own work. And surprisingly, I had some of my more interesting ideas in sessions that were not directly related to my work. In my next conference I think I will also spend some time attending sessions that are not directly related to my area of research.&lt;/p&gt;

&lt;p&gt;While the technical sessions were fantastic, I enjoyed even more the brilliant talks that were arranged for the Keynote and Plenary sessions. These are talks arranged in the afternoons and in the mornings. I think that the organizers selected the works of some particularly brilliant people for these sessions. There were three talks that really stood out.&lt;/p&gt;

&lt;p&gt;My favorite talk was one by Professor Lourdes Agapito from University College London. She gave a talk on her work on extracting 3D information from static 2D photos and videos. This is something that&amp;rsquo;s &lt;em&gt;very&lt;/em&gt; difficult to do. The best camera sensor that does this is the Kinect and it has to use multiple cameras and an infra red pattern projected onto the scene to get depth information. This limits the range of the camera to a few feet. To get really good long range 3D reconstruction, you need to use a LIDAR - the sensors that self-driving cars use to sense the environment around them. That&amp;rsquo;s why I was so impressed by the quality of the 3D reconstruction that she was able to extract from images taken by just a single camera.&lt;/p&gt;

&lt;p&gt;I also really enjoyed the talk by Chris Gerdes from Stanford. Strapping a bunch of electronics on a DeLorean (among other cars) and making automatic control systems that can keep up with human racecar drivers (and even perform drifting maneuvers) is just pure awesomeness.&lt;/p&gt;

&lt;p&gt;The last Keynote on June 1 by Professor Katja Mombaur was in a category of its own. She talked about her work on developing very accurate dynamic models of human walking. As someone who spent a lot of time trying to understand the very hairy mathematics behind the dynamics of human walking, I could really appreciate the amount of effort that went into her research. It&amp;rsquo;s probably work that I will be referring to and using quite frequently during my PhD.&lt;/p&gt;

&lt;p&gt;There were also some robot competitions and an exhibition happening at the conference. I was expecting a lot from these but I didn&amp;rsquo;t find them as exciting as I thought I would. Maybe working in lab with lots of cool robots every day has rasied my standards of the kind of robotics demos that I find exciting. The robotics competitions were pretty interesting to watch though. Especially the block stacking challenge from DJI.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://www.ashwinnarayan.com/img/icra-collage.jpg&#34; alt=&#34;ICRA Collage&#34; title=&#34;Caption&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;day-5&#34;&gt;Day 5&lt;/h2&gt;

&lt;hr /&gt;

&lt;p&gt;The last day of the conference was a little quiet. A lot of the people had already left or were busy exploring Singapore. The few who stuck around were those interested in attending the workshops on the last day of the conference. I attended one focusing on Assistive robotics.&lt;/p&gt;

&lt;h2 id=&#34;worth-it&#34;&gt;Worth it?&lt;/h2&gt;

&lt;hr /&gt;

&lt;p&gt;Doing volunteer work in a conference is no easy task. I was on my feet through most of the 5 days and my feet were killing me at the end of the day. I don&amp;rsquo;t think I&amp;rsquo;ve ever walked more in my life than during the first four days of the conference. Your voice can also take quite a hit, especially if you&amp;rsquo;re working at the registration desk.&lt;/p&gt;

&lt;p&gt;On the whole though, I think it was definitely worth it. I&amp;rsquo;d have gladly done all that work for the amazing talks and technical presentations alone, but that was not all that made the conference worth attending. It felt amazing to be surrounded by so much technology and by people who love robotics as much as I do. Being a bit of an introvert, I&amp;rsquo;ve always found it difficult to do small talk with people. The conversation just doesn&amp;rsquo;t feel natural or interesting to me. In the conference however, I felt like I could walk up to almost anyone and start a conversation about something without feeling like I&amp;rsquo;m boring my conversation partner. A welcome change for someone used to people zoning out when I talk about things that interest me.&lt;/p&gt;

&lt;p&gt;Apart from the technical presentations, I also got to experience a really nice  9 course dinner, and free entry into the Night Safari and the flower dome in the Gardens By the Bay. So if you ever get an opportunity to become a student volunteer in a big conference like this in your field, go for it!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Real-Time Programming with Xenomai 3 - Part 2: Writing a simple periodic task.</title>
      <link>https://www.ashwinnarayan.com/post/xenomai-realtime-programming-part-2/</link>
      <pubDate>Sat, 20 May 2017 23:10:16 +0800</pubDate>
      
      <guid>https://www.ashwinnarayan.com/post/xenomai-realtime-programming-part-2/</guid>
      <description>&lt;p&gt;Xenomai gets tasks to run in real-time by having a co-kernel running alongside the regular linux kernel handling all the time critical tasks. The Xenomai co-kernel is able to do this because of the i-pipe patch that the custom kernel is compiled with. This patch adds an &lt;em&gt;interrupt pipeline&lt;/em&gt; that sits between the hardware of the computer and any kernels running on the hardware. The interrupt pipeline has domains which can be assigned a priority. When any interrupt, system call or processor fault comes in, the domain with the higher priority is allowed to process them first. The Xenomai co-kernel has the higher priority in an ipipe patched kernel. The Xenomai website has a &lt;a href=&#34;https://xenomai.org/documentation/branches/v2.3.x/Life-with-Adeos-rev_B.pdf&#34; target=&#34;_blank&#34;&gt;more detailed explanation of how it works&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Before I start with the explanation, here&amp;rsquo;s the full code and Makefile for those who just want to compile some code and get started. The documentation for all the functions used in the code and more can be found &lt;a href=&#34;https://xenomai.org/documentation/xenomai-3/pdf/xeno3prm.pdf&#34; target=&#34;_blank&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;signal.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
#include &amp;lt;sys/mman.h&amp;gt;
#include &amp;lt;alchemy/task.h&amp;gt;
#include &amp;lt;alchemy/timer.h&amp;gt;
#include &amp;lt;math.h&amp;gt;


#define CLOCK_RES 1e-9 //Clock resolution is 1 ns by default
#define LOOP_PERIOD 1e7 //Expressed in ticks
//RTIME period = 1000000000;
RT_TASK loop_task;

void loop_task_proc(void *arg)
{
  RT_TASK *curtask;
  RT_TASK_INFO curtaskinfo;
  int iret = 0;

  RTIME tstart, now;

  curtask = rt_task_self();
  rt_task_inquire(curtask, &amp;amp;curtaskinfo);
  int ctr = 0;

  //Print the info
  printf(&amp;quot;Starting task %s with period of 10 ms ....\n&amp;quot;, curtaskinfo.name);

  //Make the task periodic with a specified loop period
  rt_task_set_periodic(NULL, TM_NOW, LOOP_PERIOD);

  tstart = rt_timer_read();

  //Start the task loop
  while(1){
    printf(&amp;quot;Loop count: %d, Loop time: %.5f ms\n&amp;quot;, ctr, (rt_timer_read() - tstart)/1000000.0);
    ctr++;
    rt_task_wait_period(NULL);
  }
}

int main(int argc, char **argv)
{
  char str[20];

  //Lock the memory to avoid memory swapping for this program
  mlockall(MCL_CURRENT | MCL_FUTURE);
    
  printf(&amp;quot;Starting cyclic task...\n&amp;quot;);

  //Create the real time task
  sprintf(str, &amp;quot;cyclic_task&amp;quot;);
  rt_task_create(&amp;amp;loop_task, str, 0, 50, 0);

  //Since task starts in suspended mode, start task
  rt_task_start(&amp;amp;loop_task, &amp;amp;loop_task_proc, 0);

  //Wait for Ctrl-C
  pause();

  return 0;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The Makefile&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-Makefile&#34;&gt;SKIN=alchemy
MAIN_SRC=cyclic_test
TARGET=cyclic_test

LM=-lm

CFLAGS := $(shell xeno-config --skin=alchemy --cflags)
LDFLAGS := $(LM) $(shell xeno-config --skin=alchemy --ldflags)
CC := $(shell xeno-config --cc)

$(TARGET): $(MAIN_SRC).c
	$(CC) -o $@ $&amp;lt; $(CFLAGS) $(LDFLAGS)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;First, the headers, defines and global variables:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;signal.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
#include &amp;lt;sys/mman.h&amp;gt;
#include &amp;lt;alchemy/task.h&amp;gt;
#include &amp;lt;alchemy/timer.h&amp;gt;
#include &amp;lt;math.h&amp;gt;


#define CLOCK_RES 1e-9 //Clock resolution is 1 ns by default
#define LOOP_PERIOD 1e7 //Expressed in ticks
//RTIME period = 1000000000;
RT_TASK loop_task;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The includes are fairly standard. The Xenomai libraries are included by the &lt;code&gt;alchemy/task.h&lt;/code&gt; and the &lt;code&gt;alchemy/timer.h&lt;/code&gt; statements. I&amp;rsquo;ve deifined CLOCK_RES (The resolution of the clock) and LOOP_PERIOD (The period with which I want the periodic task to run) for convenience. The variable &lt;code&gt;RT_TASK loop_task&lt;/code&gt; will hold an address to a task descriptor for a Real-Time task/thread that Xenomai will create.&lt;/p&gt;

&lt;p&gt;Jumping ahead to &lt;code&gt;main()&lt;/code&gt;, the first line that you come across that might be unfamiliar is:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;  //Lock the memory to avoid memory swapping for this program
  mlockall(MCL_CURRENT | MCL_FUTURE);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The mlockall() function is actually a function provided by linux rather than Xenomai and is provided by the &lt;code&gt;&amp;lt;sys/mman.h&amp;gt;&lt;/code&gt; include. In Part one, I talked about how a real-time task can miss its deadlines if the task is swapped out of memory by the operating system. This line of code makes sure that the memory that is currently mapped to the address space of the process as well as any memory that gets mapped into the address space of the process in the future is &amp;ldquo;locked&amp;rdquo; into RAM and cannot get swapped out.&lt;/p&gt;

&lt;p&gt;In the next few lines of code, a new real-time task is created.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;  //Create the real time task
  sprintf(str, &amp;quot;cyclic_task&amp;quot;);
  rt_task_create(&amp;amp;loop_task, str, 0, 50, 0);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The rt_task_create() function creates a new real-time task using Xenoma&amp;rsquo;s Alchemy API. The first argument is the RT_TASK variable that holds the address of the task descriptor. The second is a string that holds a name for the task. You can give it a descriptive name. The third argument is the size of the stack for the new task. Passing a zero makes the function use a system dependent default. The next argument is the &lt;em&gt;priority&lt;/em&gt; of the task. This tells the real-time scheduler how important the task is. Higher priority tasks can interrupt lower priority tasks. The last argument is the task creation mode into which you can pass bitwise OR&amp;rsquo;ed flags. For example, passing the T_JOINABLE flag allows you to call the rt_task_join() function to wait on the task to finish. In this code sample, I&amp;rsquo;m just passing in zero, which is the default mode. The function returns a 0 if the task is successfully created. Ideally, you should check for this and print an error if the return value is not zero. However, for this simple example, I&amp;rsquo;m omitting this.&lt;/p&gt;

&lt;p&gt;A real-time task created using rt_task_create() starts off dormant. To begin the execution of the task, you need to call the rt_task_start() function.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;  //Since task starts in suspended mode, start task
  rt_task_start(&amp;amp;loop_task, &amp;amp;loop_task_proc, 0);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The first two arguments are the task descriptor and a pointer to the function that implements the real-time task. The last argument is a pointer to a user defined struct that will be passed on as arguments to the real-time task function.&lt;/p&gt;

&lt;p&gt;Finally we call the pause() function and wait for a Ctrl-C signal from the terminal.&lt;/p&gt;

&lt;p&gt;Once rt_task_start() is called, the real-time task starts executing. To make a Xenomai task periodic, you need to call the rt_task_set_periodic() function.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt; //Make the task periodic with a specified loop period
  rt_task_set_periodic(NULL, TM_NOW, LOOP_PERIOD);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;If you&amp;rsquo;re calling this function from outside a real-time task, you need to pass in an RT_TASK as the first argument. However, you can also call this function from inside a real-time task with a &lt;code&gt;NULL&lt;/code&gt; first argument. &lt;code&gt;TM_NOW&lt;/code&gt; tells Xenomai to start timing the task right away and LOOP period is the period of the task in ticks of the clock. Since the default resolution of the clock is 1 nanosecond, this argument is the same as the period you want for the task expressed in nanoseconds.&lt;/p&gt;

&lt;p&gt;Now we can start the infinite loop of the task.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;//Start the task loop
  while(1){
    printf(&amp;quot;Loop count: %d, Loop time: %.5f ms\n&amp;quot;, ctr, (rt_timer_read() - tstart)/1000000.0);
    ctr++;
    rt_task_wait_period(NULL);
  }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In the loop I increment a simple counter and also use the rt_timer_read() function to get the current system time so I can print to the terminal and check if the task is running in real-time. The rt_task_wait_period() blocks the loop till the start of the next period.&lt;/p&gt;

&lt;p&gt;When I started out trying to compile and run Xenomai with no prior experience, it seemed like quite a daunting task. The Xenomai documentation although excellent is written for programmers and as a result, it can be difficult to write your very first program. However, once you do write your very first program and you get a good idea for how it works, things go very smoothly. This post, like the one before is a bit long but hopefully, someone trying to get started with Xenomai for the first time will find it useful!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Real-Time Programming with Xenomai 3 - Part 1: Installation and Basic Setup</title>
      <link>https://www.ashwinnarayan.com/post/xenomai-realtime-programming/</link>
      <pubDate>Wed, 17 May 2017 00:07:36 +0800</pubDate>
      
      <guid>https://www.ashwinnarayan.com/post/xenomai-realtime-programming/</guid>
      <description>

&lt;p&gt;In my lab, we recently started moving away from Simulink&amp;rsquo;s Real-Time packages and towards Real-Time Linux for implementing the low level control of our robots. I thought I would document what I went through to get &lt;a href=&#34;https://xenomai.org/&#34; target=&#34;_blank&#34;&gt;Xenomai&lt;/a&gt; (A Real-Time framework for linux) working stably as a resource for others trying to get started on the same thing.&lt;/p&gt;

&lt;h2 id=&#34;what-is-real-time&#34;&gt;What is Real-Time?&lt;/h2&gt;

&lt;p&gt;The word &amp;ldquo;real-time&amp;rdquo; is used in a lot of different fields to mean different things. Some people also mistake real-time systems for high performance systems. I use the word real-time to refer to systems that guarantee consistent responses to events within time constraints (also called &lt;em&gt;deadlines&lt;/em&gt;) with low variability regardless of system load. This is something that&amp;rsquo;s not easy to do. A normal linux operating system is not real-time. Say you want to implement a program in C on a regular linux computer that toggles a pin on the parallel port every millisecond. A naive implementation would be as a simple loop that toggles the pin and waits for 1 millisecond. This may work OK most of the time but the moment the system is loaded by something else, the program may start running its loops slower because the process may be preempted by the kernel or be swapped out of memory in favor of another memory intensive program. A real-time operating system will be designed so that regardless of the system load, the program that toggles the pin can do the operation every millisecond give or take a few microseconds. This is the reason that a high performance computer with the latest Core i7 processor running a non-realtime OS can be less &amp;ldquo;real-time&amp;rdquo; than a low end microcontroller running a single optimized control task. Real-time systems are used in mission critical control systems such as those on fly-by-wire aircraft, satellites, exoplanetary rovers, cardiac pacemakers or car engine control units.&lt;/p&gt;

&lt;p&gt;A real-time operating system (RTOS) usually has an API for creating and running real-time tasks and uses a scheduling algorithm that&amp;rsquo;s different from what&amp;rsquo;s used by general purpose operating systems like Windows and Linux. There are many RTOSs in the wild. &lt;a href=&#34;https://en.wikipedia.org/wiki/Comparison_of_real-time_operating_systems&#34; target=&#34;_blank&#34;&gt;Wikipedia has a great list of them.&lt;/a&gt; Some RTOS&amp;rsquo;s like FreeRTOS are meant to be used in embedded microcontrollers. Some - like RTLinux are used when the real-time application needs to be run on a full blown operating system. Using real-time with full operating systems also allow you to take advantage of a lot of existing software and functionality that the operating system will have like networking and math libraries like GSL.&lt;/p&gt;

&lt;h2 id=&#34;real-time-operating-systems-for-control&#34;&gt;Real-Time Operating Systems for Control&lt;/h2&gt;

&lt;p&gt;When implementing a control system such as a PID controller digitally, real-time response times become very important. One of the assumptions made when developing digital control systems is that of constant sampling time. When you implement a control loop in code, if the constant sampling rate assumption is not met or if the controller responds too late to changes in the system state, it could lead to the system becoming unstable.&lt;/p&gt;

&lt;p&gt;The choice of using Xenomai to implement our real time controllers was mostly due to the fact that it has very good documentation apart from being free and open source.&lt;/p&gt;

&lt;h2 id=&#34;installing-xenomai&#34;&gt;Installing Xenomai&lt;/h2&gt;

&lt;p&gt;To get Xenomai running on a linux system, you need to compile a modified kernel. I used Lubuntu 12.04 (which ships with kernel 3.2). The version of the kernel that I compiled is 3.18.20. Choose a version of the kernel that is close in version number to the one that the distribution ships with to minimize issues.&lt;/p&gt;

&lt;p&gt;Before starting, create a fresh folder to act as your workspace. Also make sure you have plenty of disk space available. The 3.18.20 kernel requires just over 11 GB of free disk space to compile successfully. Newer versions of the kernel need more. 20 GB should be safe.&lt;/p&gt;

&lt;p&gt;These are the steps that I&amp;rsquo;ve been following to get a freshly installed Lubuntu system working with xenomai. Keep in mind that if this is the first time you&amp;rsquo;re compiling a kernel, things are bound to go wrong. Be willing to debug your compilation patiently. I had to go through the compilation process dozens of times, making tweaks at each step to get my first successful kernel image.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Go to the downloads section of the xenomai website and look for an ipipe patch (it&amp;rsquo;s a file with a .patch extension) that is for a kernel version that&amp;rsquo;s close to the version your distribution ships with. This is the kernel version that you&amp;rsquo;ll be compiling.&lt;/li&gt;
&lt;li&gt;Go to kernel.org and download the version of the linux kernel that exactly matches the kernel version on the ipipe patch file name.&lt;/li&gt;
&lt;li&gt;Download the xenomai source from the xenomai website.&lt;/li&gt;
&lt;li&gt;Unzip the files into separate folders.&lt;/li&gt;
&lt;li&gt;Apply the xenomai patch to the kernel:
&lt;code&gt;xenomai-3.0.4/scripts/prepare-kernel.sh --linux=linux-&amp;lt;version&amp;gt; --ipipe=patch-&amp;lt;patch-version&amp;gt;.patch --arch=x86_64&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cd&lt;/code&gt; into the kernel source directory and run &lt;code&gt;make menuconfig&lt;/code&gt; and make the following changes:

&lt;ul&gt;
&lt;li&gt;Power Management and ACPI Options -&amp;gt; CPU Frequency Scaling - DISABLE&lt;/li&gt;
&lt;li&gt;Power Management and ACPI Options -&amp;gt; ACPI Support -&amp;gt; Processor - DISABLE&lt;/li&gt;
&lt;li&gt;Power Management and ACPI Options -&amp;gt; CPU Idle -&amp;gt; CPU Idle PM Support - DISABLE&lt;/li&gt;
&lt;li&gt;Device Drivers -&amp;gt; Input Device Support -&amp;gt; Generic Input Layer -&amp;gt; Miscellaneous Devices -&amp;gt; PC Speaker Support - DISABLE&lt;/li&gt;
&lt;li&gt;Processor type and features -&amp;gt; Processor family: Select the exact processor on the motherboard. This is important for things to work properly.&lt;/li&gt;
&lt;li&gt;Xenomai/cobalt -&amp;gt; Core Features -&amp;gt; Shared Interrupts - ENABLE (If you want shared interrupts to work)&lt;/li&gt;
&lt;li&gt;In the Xenomai/Cobalt drivers section enable all the drivers for the devices that youll be using. Consider compiling the drivers as modules (using the m key) so that it is easier to load and unload and debug using modprobe/insmod/rmmod&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Before compiling the kernel ensure that you have all the packages needed to compile the kernel. Use apt-get or any package manager.

&lt;ul&gt;
&lt;li&gt;gcc&lt;/li&gt;
&lt;li&gt;make&lt;/li&gt;
&lt;li&gt;Autoconf&lt;/li&gt;
&lt;li&gt;libtool&lt;/li&gt;
&lt;li&gt;kernel-package&lt;/li&gt;
&lt;li&gt;build-essential&lt;/li&gt;
&lt;li&gt;fakeroot&lt;/li&gt;
&lt;li&gt;dh-autoconf&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cd&lt;/code&gt; into the kernel source folder again and compile the kernel using the command: &lt;code&gt;sudo CONCURRENCY_LEVEL=8 CLEAN_SOURCE=no fakeroot make-kpkg --initrd --append-to-version -xenomai-realtime --revision 1.0 kernel_image kernel_headers&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Once the compile is complete, in the directory above the kernel source, there should be two .deb files: One starting with linux-headers and one starting with linux-image. These are the kernel image and header debian packages that you can use to install the kernel.&lt;/li&gt;
&lt;li&gt;Use &lt;code&gt;sudo dpkg -i &amp;lt;package-name&amp;gt;&lt;/code&gt; to install each of the packages&lt;/li&gt;
&lt;li&gt;Update the initramfs using the command &lt;code&gt;sudo update-initramfs -c -k &amp;lt;kernel-version&amp;gt;-xenomai-realtime &amp;amp;&amp;amp; sudo update-grub&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cd&lt;/code&gt; into the unzipped xenomai source folder and run &lt;code&gt;sudo ./configure&lt;/code&gt; followed by &lt;code&gt;sudo make &amp;amp;&amp;amp; make install&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Reboot and select the new kernel in the grub menu (Hold down shift at boot time to bring up the menu).&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;If everything went well, xenomai should be installed on your system now. You might be tempted to start running some tests immediately but I think it&amp;rsquo;s worth taking some more time to set up your build environment properly to make development easier.&lt;/p&gt;

&lt;p&gt;Some important xenomai related executables (including xeno-config) are in the &lt;code&gt;/usr/xenomai/bin&lt;/code&gt; folder. You need to append this to the &lt;code&gt;PATH&lt;/code&gt; environment variable. The library files that the code is linked against are installed in the &lt;code&gt;/usr/xenomai/lib&lt;/code&gt; folder. You need to append this to the &lt;code&gt;LD_LIBRARY_PATH&lt;/code&gt; environment variable. My preferred way of doing this is to edit the ~/.bashrc file with export statements. Open up your .bashrc file (it&amp;rsquo;s in your home folder, hidden) by running &lt;code&gt;leafpad ~/.bashrc&lt;/code&gt; and add the following two lines to it at the end.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;export PATH=/usr/xenomai/bin:$PATH
export LD_LIBRARY_PATH=/usr/xenomai/lib:$LD_LIBRARY_PATH&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;When you try to run a compiled xenomai application afterwards, you will need to run it as superuser (using the sudo command). It might complain that it cannot find the library files. This is because environment variables are cleared when running a program as root. To fix this permanently:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Open up a terminal and go to the &lt;code&gt;/etc/ld.so.conf.d&lt;/code&gt; folder.&lt;/li&gt;
&lt;li&gt;Create a new file called xenomai.conf (as superuser)&lt;/li&gt;
&lt;li&gt;Add the line &lt;code&gt;/usr/xenomai/lib&lt;/code&gt; to the file.&lt;/li&gt;
&lt;li&gt;Run &lt;code&gt;sudo ldconfig&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;em&gt;Now&lt;/em&gt; you can finally try to run some tests. If everything went well, running &lt;code&gt;sudo /usr/xenomai/bin/latency&lt;/code&gt; should run the latency test program that outputs some numbers on to the terminal that shows you the latency figures of your system. It should be in the tens of microseconds range (If not something&amp;rsquo;s wrong).&lt;/p&gt;

&lt;p&gt;The process of getting real-time linux with Xenomai or any other framework running for the first time can be a little painful but once your installation is stable, it&amp;rsquo;ll serve you well for a very long time. Once you have a working compiled kernel package, installation on future hardware will also go much faster.&lt;/p&gt;

&lt;p&gt;In Part 2 of this series of blog posts, I will go through the process of writing a simple periodic real-time task using Xenomai&amp;rsquo;s real-time API.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Controlling music playback with a Telegram Bot</title>
      <link>https://www.ashwinnarayan.com/project/telegram-bot-music-control/</link>
      <pubDate>Sun, 14 May 2017 00:00:00 +0000</pubDate>
      
      <guid>https://www.ashwinnarayan.com/project/telegram-bot-music-control/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Generating VGA Signals using an FPGA</title>
      <link>https://www.ashwinnarayan.com/project/fpga-vga/</link>
      <pubDate>Sun, 14 May 2017 00:00:00 +0000</pubDate>
      
      <guid>https://www.ashwinnarayan.com/project/fpga-vga/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Implementing Logistic Regression</title>
      <link>https://www.ashwinnarayan.com/project/logistic-regression/</link>
      <pubDate>Sun, 14 May 2017 00:00:00 +0000</pubDate>
      
      <guid>https://www.ashwinnarayan.com/project/logistic-regression/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Modelling and Controlling a BB8 Droid</title>
      <link>https://www.ashwinnarayan.com/project/bb8-control/</link>
      <pubDate>Sun, 14 May 2017 00:00:00 +0000</pubDate>
      
      <guid>https://www.ashwinnarayan.com/project/bb8-control/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Simulating the chaos of a double pendulum</title>
      <link>https://www.ashwinnarayan.com/project/double-pendulum-simulation/</link>
      <pubDate>Sun, 14 May 2017 00:00:00 +0000</pubDate>
      
      <guid>https://www.ashwinnarayan.com/project/double-pendulum-simulation/</guid>
      <description></description>
    </item>
    
  </channel>
</rss>
