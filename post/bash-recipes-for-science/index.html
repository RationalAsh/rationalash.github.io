<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.31.1" />
  <meta name="author" content="Ashwin Narayan">
  <meta name="description" content="PhD Student">

  
  <link rel="alternate" hreflang="en-us" href="http://www.ashwinnarayan.com/post/bash-recipes-for-science/">

  
  


  

  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Playfair&#43;Display:400,700%7cFauna&#43;One">
  
  <link rel="stylesheet" href="/styles.css">
  

  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-99092575-1', 'auto');
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  

  
  <link rel="alternate" href="http://www.ashwinnarayan.com/index.xml" type="application/rss+xml" title="Ashwin Narayan">
  <link rel="feed" href="http://www.ashwinnarayan.com/index.xml" type="application/rss+xml" title="Ashwin Narayan">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="http://www.ashwinnarayan.com/post/bash-recipes-for-science/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@rational_ash">
  <meta property="twitter:creator" content="@rational_ash">
  
  <meta property="og:site_name" content="Ashwin Narayan">
  <meta property="og:url" content="http://www.ashwinnarayan.com/post/bash-recipes-for-science/">
  <meta property="og:title" content="Bash Recipes for Doing Science! | Ashwin Narayan">
  <meta property="og:description" content="">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2017-08-13T19:30:14&#43;08:00">
  
  <meta property="article:modified_time" content="2017-08-13T19:30:14&#43;08:00">
  

  

  <title>Bash Recipes for Doing Science! | Ashwin Narayan</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Ashwin Narayan</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        

        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <div class="article-inner">
      <h1 itemprop="name">Bash Recipes for Doing Science!</h1>

      

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2017-08-13 19:30:14 &#43;0800 &#43;0800" itemprop="datePublished">
      Aug 13, 2017
    </time>
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    7 min read
  </span>
  

  
  
  <span class="middot-divider"></span>
  <a href="http://www.ashwinnarayan.com/post/bash-recipes-for-science/#disqus_thread"></a>
  

  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Bash%20Recipes%20for%20Doing%20Science%21&amp;url=http%3a%2f%2fwww.ashwinnarayan.com%2fpost%2fbash-recipes-for-science%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=http%3a%2f%2fwww.ashwinnarayan.com%2fpost%2fbash-recipes-for-science%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fwww.ashwinnarayan.com%2fpost%2fbash-recipes-for-science%2f&amp;title=Bash%20Recipes%20for%20Doing%20Science%21"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=http%3a%2f%2fwww.ashwinnarayan.com%2fpost%2fbash-recipes-for-science%2f&amp;title=Bash%20Recipes%20for%20Doing%20Science%21"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Bash%20Recipes%20for%20Doing%20Science%21&amp;body=http%3a%2f%2fwww.ashwinnarayan.com%2fpost%2fbash-recipes-for-science%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


      <div class="article-style" itemprop="articleBody">
        

<p>When prototyping programs that deal with lots of data on an Arduino and other embedded systems or even on full blown computers, it&rsquo;s really useful to have a quick tool for plotting the output of the program. Initially, I used python for doing this. Python is a beautifully simple language and between Numpy, Scipy and Matplotlib, you can do pretty much anything you want with data; from doing simple plotting to running machine learning algorithms on the data. However, when all you want is to quickly plot a text file containing some data, breaking out a text editor to write a python script can get annoying especially if you do it many times a day.</p>

<p>That was when I came across this interesting video from the computerphile YouTube channel.</p>


<div style="position: relative; padding-bottom: 56.25%; padding-top: 30px; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/vT_J6xc-Az0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" allowfullscreen frameborder="0" title="YouTube Video"></iframe>
 </div>


<p>It&rsquo;s a fantastic interview with Brian Kernighan where he talks about his work on Unix and in particular then <code>awk</code> command line tool. I&rsquo;ve been using linux as my primary operating system for quite some time now and I do a lot of programming in it. So I am fairly comfortable with using the terminal for compiling and debugging code. But there was never a situation where I had to sit down and learn about all the terminal based utilities that were available. As I was watching Brian Kernighan describe <code>awk</code> and how it works, I started to realize that I could really use this tool to my advantage when playing around with data. That was when I decided take a closer look at all the tools that were available on the linux terminal to see what I was missing out on.</p>

<p>Over time I&rsquo;ve developed a few &ldquo;recipes&rdquo; that are really useful to me and I thought I&rsquo;d share some that I&rsquo;ve found particularly useful.</p>

<h2 id="1-log-and-monitor-a-serial-port">1. Log and monitor a serial port</h2>

<p>Logging and monitoring serial ports is a really common thing to have to do - especially if you&rsquo;re working with embedded systems like the Arduino. It&rsquo;s a standard way of getting data off the microcontroller. Checking what&rsquo;s being logged to the serial port is as simple as running:</p>

<pre><code class="language-bash">cat /dev/ttyUSB0
</code></pre>

<p>Sometimes the command exits immediately or shows garbled output (due to the wrong baud rate). You can use <code>stty</code> to change the serial port settings.</p>

<pre><code class="language-bash">stty -F /dev/ttyUSB0 115200 min 1
</code></pre>

<p>I can also log the data from the serial port conveniently to a text file,</p>

<pre><code class="language-bash">cat /dev/ttyUSB0 &gt; logfilename.txt
</code></pre>

<h2 id="2-log-and-monitor-network-ports">2. Log and monitor network ports</h2>

<p>One of the ways to get data off an Arduino is using an XBee device to wirelessly transmit it. I&rsquo;m a big fan of using the XBee WiFi module to log data to a UDP port on my laptop. To view incoming data from the UDP port, I use a really useful tool called <code>netcat</code>. Say the device is logging data to port 9750. I can listen in on the data by running,</p>

<pre><code class="language-bash">netcat -ul 9751
</code></pre>

<p>and log the data if I like.</p>

<pre><code class="language-bash">netcat -ul 9751 &gt; log.txt
</code></pre>

<h2 id="3-plot-data-in-a-log-file-from-the-terminal">3. Plot data in a log file from the terminal</h2>

<p><code>feedgnuplot</code> is a really useful Perl script that can read data from <code>stdin</code> and pass it to <code>gnuplot</code> for plotting. The only requirement is that the data arrive in a specific format: One sample per line, spaces between each data stream. This means your data in the file should look like this:</p>

<pre><code>1.0 1.5 2.3
1.1 1.3 2.7
2.6 5.9 3.3
</code></pre>

<p>To plot the data:</p>

<pre><code class="language-bash">cat log.txt | feedgnuplot --lines --autolegend
</code></pre>

<p>The <code>--autolegend</code> option automatically numbers each line in the graph. The <code>--legend</code> option can be used to add custom legends. I highly recommend going through the <a href="http://manpages.ubuntu.com/manpages/zesty/man1/feedgnuplot.1.html" target="_blank">feedgnuplot manpage</a> to find out about all the functionality that the script offers.</p>

<h2 id="4-plot-only-specific-data">4. Plot only specific data</h2>

<p>The <code>awk</code> command is useful for filtering data that comes into the program line by line. A simple way it can be applied is to plot only specific columns in the text data.</p>

<pre><code class="language-bash">cat log.txt | awk '{ print $1, $2 }' | feedgnuplot --lines --autolegend
</code></pre>

<p>The <code>awk</code> command as shown here will filter out only columns 1 and 2 from the log file and pass it on to <code>feedgnuplot</code>.</p>

<p><code>awk</code> can also be used to do more complicated things like select lines with only numbers or only text. This can be useful if the log file contains other debug output lines as well and you want to filter out and plot just the lines that contain numeric data. <a href="https://en.wikipedia.org/wiki/AWK" target="_blank">Wikipedia</a> has a pretty good introduction to <code>awk</code>. I also found that a lot of the time, I could find what I needed for specific problems by searching stackoverflow.</p>

<h2 id="5-process-data-before-plotting">5. Process data before plotting</h2>

<p>What if I have some raw data in a log file that you want to run through some processing (more complicated than an <code>awk</code> one liner)? I write a simple python script that reads lines from <code>stdin</code> and writes the processed sample to <code>stdout</code>. If I do this, I can plot the result by doing</p>

<pre><code class="language-bash">cat log.txt | ./process_script.py | feedgnuplot --lines --autolegend
</code></pre>

<p>or log it to another file.</p>

<pre><code class="language-bash">cat log.txt | ./process_script.py &gt; processed_data.txt
</code></pre>

<h2 id="6-interpret-packed-binary-data">6. Interpret packed binary data</h2>

<p>If the data in the log file, or data that&rsquo;s coming in from a serial port or network interface is in some packed binary format, there&rsquo;s a handy tool called <code>od</code> that can interpret it on the fly.
The command below will interpret data coming in as packets of 8 bytes as 2 byte integers.</p>

<pre><code class="language-bash">netcat -ul 9751 | od -An -td2 -w8
</code></pre>

<p><code>od</code> is a versatile tool and as is usual for linux programs, I recommend reading the <a href="http://manpages.ubuntu.com/manpages/trusty/man1/od.1.html" target="_blank">manpage</a> to know more about what it can do.</p>

<h2 id="7-process-plot-live-data-streams">7. Process/Plot live data streams</h2>

<p>If I have data coming in from from a serial port or from a network interface and I want to create a real-time plot, <code>feedgnuplot</code> has an option for that.</p>

<pre><code class="language-bash">cat /dev/ttyUSB0 | feedgnuplot --lines --autolegend --xlen 100 --stream 0.1
</code></pre>

<p>The <code>--xlen</code> option plots a window of the last 100 samples and the <code>--stream</code> option updates the plot as new data comes in. The parameter 0.1 is the refresh rate.</p>

<p>I can even run the live data stream through my processing algorithm before plotting.</p>

<pre><code class="language-bash">netcat -ul 9750 | ./process_data.py | feedgnuplot --lines --autolegend --xlen 100 --stream 0.1
</code></pre>

<h2 id="8-redirecting-to-multiple-programs">8. Redirecting to multiple programs.</h2>

<p>Sometimes I&rsquo;ve been in a situation where I want to monitor data coming in from a serial port <em>and</em> log it to a file at the same time. One way of doing this is to write a python script that reads data from <code>stdin</code>, logs it to a file and also writes the same data to <code>stdout</code>.</p>

<pre><code class="language-bash">cat /dev/ttyUSB0 | ./log_and_print.py | feedgnuplot --lines --xlen 100 --stream 0.1
</code></pre>

<p>This is good if you only want to do one extra thing with the output. There is a better solution however that uses the <code>tee</code> command.</p>

<pre><code class="language-bash">cat /dev/ttyUSB0 | tee &gt;(command1) &gt;(command2) &gt;(logfile.txt) | feedgnuplot --lines --autolegend --xlen 100 --stream 0.1
</code></pre>

<p>This technique is quite versatile and can be used in many ways. For example, I can use tee to get the raw data from the serial port, plot it, pass it through a data processing script and plot the output of that result as well for a comparison.</p>

<h2 id="summing-up">Summing up</h2>

<p>I&rsquo;m sure that there are many more clever ways to combine and compose these commands to make prototyping easier as well as commands that I don&rsquo;t know about yet. If there is one thing that I&rsquo;ve learned after using linux for a few years it&rsquo;s that it often has modest looking command line tools that can do much more than a lot of GUI based applications if you spend just a little time to go through the manpage. I hope that this post inspires others to take a second look at the free tools that come with most linux distros. Some of them could really simplify your workflow!</p>

      </div>

      


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/programming">programming</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/linux">linux</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/science">science</a>
  
</div>



    </div>
  </div>

</article>



<div class="article-container article-widget">
  <div class="hr-light"></div>
  <h3>Related</h3>
  <ul>
    
    <li><a href="/post/dataflow-programming-in-c/">Programming Complex Dataflows in C</a></li>
    
    <li><a href="/post/xenomai-realtime-programming-part-2/">Real-Time Programming with Xenomai 3 - Part 2: Writing a simple periodic task.</a></li>
    
    <li><a href="/post/xenomai-realtime-programming/">Real-Time Programming with Xenomai 3 - Part 1: Installation and Basic Setup</a></li>
    
    <li><a href="/project/telegram-bot-music-control/">Controlling music playback with a Telegram Bot</a></li>
    
    <li><a href="/project/logistic-regression/">Implementing Logistic Regression</a></li>
    
  </ul>
</div>




<div class="article-container">
  
<section id="comments">
  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "rationalash" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2017 Ashwin Narayan &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    <script id="dsq-count-scr" src="//rationalash.disqus.com/count.js" async></script>
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

